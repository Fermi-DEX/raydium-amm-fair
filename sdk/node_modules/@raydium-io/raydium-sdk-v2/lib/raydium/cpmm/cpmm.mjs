var tr=Object.defineProperty,nr=Object.defineProperties;var ir=Object.getOwnPropertyDescriptors;var kt=Object.getOwnPropertySymbols;var Vn=Object.prototype.hasOwnProperty,qn=Object.prototype.propertyIsEnumerable;var _n=(n,e,t)=>e in n?tr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U=(n,e)=>{for(var t in e||(e={}))Vn.call(e,t)&&_n(n,t,e[t]);if(kt)for(var t of kt(e))qn.call(e,t)&&_n(n,t,e[t]);return n},Z=(n,e)=>nr(n,ir(e));var he=(n,e)=>{var t={};for(var i in n)Vn.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&kt)for(var i of kt(n))e.indexOf(i)<0&&qn.call(n,i)&&(t[i]=n[i]);return t};import{PublicKey as B}from"@solana/web3.js";import{AccountLayout as Bs,NATIVE_MINT as $t,TOKEN_PROGRAM_ID as ce,createAssociatedTokenAccountIdempotentInstruction as $i}from"@solana/spl-token";import ke from"bn.js";var Ue=9e15,Ne=1e9,en="0123456789abcdef",ht="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Bt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",tn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ue,maxE:Ue,crypto:!1},Hn,Be,W=!0,xt="[DecimalError] ",Ke=xt+"Invalid argument: ",zn=xt+"Precision limit exceeded",Zn=xt+"crypto unavailable",jn="[object Decimal]",oe=Math.floor,ee=Math.pow,rr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,or=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,sr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Qn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,be=1e7,E=7,ar=9007199254740991,ur=ht.length-1,nn=Bt.length-1,y={toStringTag:jn};y.absoluteValue=y.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),R(n)};y.ceil=function(){return R(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Ke+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};y.comparedTo=y.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};y.cosine=y.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+E,i.rounding=1,t=cr(i,ti(i,t)),i.precision=n,i.rounding=e,R(Be==2||Be==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};y.cubeRoot=y.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(W=!1,o=l.s*ee(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ie(l.d),n=l.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ee(t,1/3),n=oe((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new m(t),i.s=l.s):i=new m(o.toString()),s=(n=m.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(l),i=X(u.plus(l).times(a),u.plus(c),s+2,1),ie(a.d).slice(0,s)===(t=ie(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(R(a,n+1,0),a.times(a).times(a).eq(l))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(R(i,n+1,1),e=!i.times(i).times(i).eq(l));break}return W=!0,R(i,n,m.rounding,e)};y.decimalPlaces=y.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-oe(this.e/E))*E,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};y.dividedBy=y.div=function(n){return X(this,new this.constructor(n))};y.dividedToIntegerBy=y.divToInt=function(n){var e=this,t=e.constructor;return R(X(e,new t(n),0,1,1),t.precision,t.rounding)};y.equals=y.eq=function(n){return this.cmp(n)===0};y.floor=function(){return R(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(n){return this.cmp(n)>0};y.greaterThanOrEqualTo=y.gte=function(n){var e=this.cmp(n);return e==1||e===0};y.hyperbolicCosine=y.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/Ct(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=Ge(s,1,o.times(e),new s(1),!0);for(var c,u=n,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return R(o,s.precision=t,s.rounding=i,!0)};y.hyperbolicSine=y.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=Ge(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/Ct(5,n)),r=Ge(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,R(r,e,t,!0)};y.hyperbolicTangent=y.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,X(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};y.inverseCosine=y.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?fe(t,r,o):new t(0):new t(NaN):e.isZero()?fe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=fe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};y.inverseHyperbolicCosine=y.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,W=!1,t=t.times(t).minus(1).sqrt().plus(t),W=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};y.inverseHyperbolicSine=y.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,W=!1,t=t.times(t).plus(1).sqrt().plus(t),W=!0,i.precision=n,i.rounding=e,t.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?R(new o(r),n,e,!0):(o.precision=t=i-r.e,r=X(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};y.inverseSine=y.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=fe(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};y.inverseTangent=y.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=nn)return s=fe(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=nn)return s=fe(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/E+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(W=!1,e=Math.ceil(a/E),i=1,c=u.times(u),s=new l(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),W=!0,R(s,l.precision=m,l.rounding=d,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&oe(this.e/E)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(n){return this.cmp(n)<0};y.lessThanOrEqualTo=y.lte=function(n){return this.cmp(n)<1};y.logarithm=y.log=function(n){var e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(n==null)n=new l(10),e=!0;else{if(n=new l(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new l(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(W=!1,a=m+p,s=Ce(u,a),i=e?It(l,a+10):Ce(n,a),c=X(s,i,a,1),et(c.d,r=m,d))do if(a+=10,s=Ce(u,a),i=e?It(l,a+10):Ce(n,a),c=X(s,i,a,1),!o){+ie(c.d).slice(r+1,r+15)+1==1e14&&(c=R(c,m+1,0));break}while(et(c.d,r+=10,d));return W=!0,R(c,m,d)};y.minus=y.sub=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,b=p.constructor;if(n=new b(n),!p.d||!n.d)return!p.s||!n.s?n=new b(NaN):p.d?n.s=-n.s:n=new b(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=b.precision,c=b.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new b(p);else return new b(c===3?-0:0);return W?R(n,a,c):n}if(t=oe(n.e/E),l=oe(p.e/E),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),i=Math.max(Math.ceil(a/E),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,m=i<s,m&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){m=u[i]<d[i];break}o=0}for(m&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=be-1;--u[r],u[i]+=be}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=St(u,t),W?R(n,a,c):n):new b(c===3?-0:0)};y.modulo=y.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?R(new i(t),i.precision,i.rounding):(W=!1,i.modulo==9?(e=X(t,n.abs(),0,3,1),e.s*=n.s):e=X(t,n,0,i.modulo,1),e=e.times(n),W=!0,t.minus(e))};y.naturalExponential=y.exp=function(){return rn(this)};y.naturalLogarithm=y.ln=function(){return Ce(this)};y.negated=y.neg=function(){var n=new this.constructor(this);return n.s=-n.s,R(n)};y.plus=y.add=function(n){var e,t,i,r,o,s,a,c,u,l,m=this,d=m.constructor;if(n=new d(n),!m.d||!n.d)return!m.s||!n.s?n=new d(NaN):m.d||(n=new d(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(u=m.d,l=n.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(n=new d(m)),W?R(n,a,c):n;if(o=oe(m.e/E),i=oe(n.e/E),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,i=o,s=u.length),o=Math.ceil(a/E),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/be|0,u[r]%=be;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=St(u,i),W?R(n,a,c):n};y.precision=y.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ke+n);return t.d?(e=Yn(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};y.round=function(){var n=this,e=n.constructor;return R(new e(n),n.e+1,e.rounding)};y.sine=y.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+E,i.rounding=1,t=mr(i,ti(i,t)),i.precision=n,i.rounding=e,R(Be>2?t.neg():t,n,e,!0)):new i(NaN)};y.squareRoot=y.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(W=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ie(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=oe((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new l(e)):i=new l(u.toString()),t=(c=l.precision)+3;;)if(o=i,i=o.plus(X(s,o,t+2,1)).times(.5),ie(o.d).slice(0,t)===(e=ie(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(R(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(R(i,c+1,1),n=!i.times(i).eq(s));break}return W=!0,R(i,c,l.rounding,n)};y.tangent=y.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=X(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,R(Be==2||Be==4?t.neg():t,n,e,!0)):new i(NaN)};y.times=y.mul=function(n){var e,t,i,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=oe(l.e/E)+oe(n.e/E),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%be|0,e=a/be|0;o[r]=(o[r]+e)%be|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=St(o,t),W?R(n,m.precision,m.rounding):n};y.toBinary=function(n,e){return sn(this,2,n,e)};y.toDecimalPlaces=y.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(ae(n,0,Ne),e===void 0?e=i.rounding:ae(e,0,8),R(t,n+t.e+1,e))};y.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=we(i,!0):(ae(n,0,Ne),e===void 0?e=r.rounding:ae(e,0,8),i=R(new r(i),n+1,e),t=we(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=we(r):(ae(n,0,Ne),e===void 0?e=o.rounding:ae(e,0,8),i=R(new o(r),n+r.e+1,e),t=we(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};y.toFraction=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(u=t=new f(1),i=c=new f(0),e=new f(i),o=e.e=Yn(b)-p.e-1,s=o%E,e.d[0]=ee(10,s<0?E+s:s),n==null)n=o>0?e:u;else{if(a=new f(n),!a.isInt()||a.lt(u))throw Error(Ke+a);n=a.gt(e)?o>0?e:u:a}for(W=!1,a=new f(ie(b)),l=f.precision,f.precision=o=b.length*E*2;m=X(a,e,0,1,1),r=t.plus(m.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=X(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=X(u,i,o,1).minus(p).abs().cmp(X(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],f.precision=l,W=!0,d};y.toHexadecimal=y.toHex=function(n,e){return sn(this,16,n,e)};y.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:ae(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(W=!1,t=X(t,n,0,e,1).times(n),W=!0,R(t)):(n.s=t.s,t=n),t};y.toNumber=function(){return+this};y.toOctal=function(n,e){return sn(this,8,n,e)};y.toPower=y.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(ee(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return R(a,i,o);if(e=oe(n.e/E),e>=n.d.length-1&&(t=u<0?-u:u)<=ar)return r=Jn(c,a,t,i),n.s<0?new c(1).div(r):R(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ee(+a,u),e=t==0||!isFinite(t)?oe(u*(Math.log("0."+ie(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(W=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=rn(n.times(Ce(a,i+t)),i),r.d&&(r=R(r,i+5,1),et(r.d,i,o)&&(e=i+10,r=R(rn(n.times(Ce(a,e+t)),e),e+5,1),+ie(r.d).slice(i+1,i+15)+1==1e14&&(r=R(r,i+1,0)))),r.s=s,W=!0,c.rounding=o,R(r,i,o))};y.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=we(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(ae(n,1,Ne),e===void 0?e=r.rounding:ae(e,0,8),i=R(new r(i),n,e),t=we(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toSignificantDigits=y.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(ae(n,1,Ne),e===void 0?e=i.rounding:ae(e,0,8)),R(new i(t),n,e)};y.toString=function(){var n=this,e=n.constructor,t=we(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};y.truncated=y.trunc=function(){return R(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var n=this,e=n.constructor,t=we(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function ie(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=E-i.length,t&&(o+=Se(t)),o+=i;s=n[e],i=s+"",t=E-i.length,t&&(o+=Se(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function ae(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ke+n)}function et(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=E,r=0):(r=Math.ceil((e+1)/E),e%=E),o=ee(10,E-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==ee(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==ee(10,e-3)-1,s}function Tt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=en.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function cr(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/Ct(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=Ge(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var X=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,l,m,d,p,b,f,g,k,A,P,w,h,T,I,x,K,S,M,F,D=i.constructor,q=i.s==r.s?1:-1,v=i.d,O=r.d;if(!v||!v[0]||!O||!O[0])return new D(!i.s||!r.s||(v?O&&v[0]==O[0]:!O)?NaN:v&&v[0]==0||!O?q*0:q/0);for(c?(p=1,l=i.e-r.e):(c=be,p=E,l=oe(i.e/p)-oe(r.e/p)),M=O.length,K=v.length,k=new D(q),A=k.d=[],m=0;O[m]==(v[m]||0);m++);if(O[m]>(v[m]||0)&&l--,o==null?(T=o=D.precision,s=D.rounding):a?T=o+(i.e-r.e)+1:T=o,T<0)A.push(1),b=!0;else{if(T=T/p+2|0,m=0,M==1){for(d=0,O=O[0],T++;(m<K||d)&&T--;m++)I=d*c+(v[m]||0),A[m]=I/O|0,d=I%O|0;b=d||m<K}else{for(d=c/(O[0]+1)|0,d>1&&(O=n(O,d,c),v=n(v,d,c),M=O.length,K=v.length),x=M,P=v.slice(0,M),w=P.length;w<M;)P[w++]=0;F=O.slice(),F.unshift(0),S=O[0],O[1]>=c/2&&++S;do d=0,u=e(O,P,M,w),u<0?(h=P[0],M!=w&&(h=h*c+(P[1]||0)),d=h/S|0,d>1?(d>=c&&(d=c-1),f=n(O,d,c),g=f.length,w=P.length,u=e(f,P,g,w),u==1&&(d--,t(f,M<g?F:O,g,c))):(d==0&&(u=d=1),f=O.slice()),g=f.length,g<w&&f.unshift(0),t(P,f,w,c),u==-1&&(w=P.length,u=e(O,P,M,w),u<1&&(d++,t(P,M<w?F:O,w,c))),w=P.length):u===0&&(d++,P=[0]),A[m++]=d,u&&P[0]?P[w++]=v[x]||0:(P=[v[x]],w=1);while((x++<K||P[0]!==void 0)&&T--);b=P[0]!==void 0}A[0]||A.shift()}if(p==1)k.e=l,Hn=b;else{for(m=1,d=A[0];d>=10;d/=10)m++;k.e=m+l*p-1,R(k,a?o+k.e+1:o,s,b)}return k}}();function R(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor;e:if(e!=null){if(m=n.d,!m)return n;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=E,s=e,l=m[d=0],c=l/ee(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/E),a=m.length,d>=a)if(i){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=E,s=o-E+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=E,s=o-E+r,c=s<0?0:l/ee(10,r-s-1)%10|0}if(i=i||e<0||m[d+1]!==void 0||(s<0?l:l%ee(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?l/ee(10,r-s):0:m[d-1])%10&1||t==(n.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=n.e+1,m[0]=ee(10,(E-e%E)%E),n.e=-e||0):m[0]=n.e=0,n;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ee(10,E-o),m[d]=s>0?(l/ee(10,r-s)%ee(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==be&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=be)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return W&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function we(n,e,t){if(!n.isFinite())return ei(n);var i,r=n.e,o=ie(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Se(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Se(-r-1)+o,t&&(i=t-s)>0&&(o+=Se(i))):r>=s?(o+=Se(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Se(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Se(i))),o}function St(n,e){var t=n[0];for(e*=E;t>=10;t/=10)e++;return e}function It(n,e,t){if(e>ur)throw W=!0,t&&(n.precision=t),Error(zn);return R(new n(ht),e,1,!0)}function fe(n,e,t){if(e>nn)throw Error(zn);return R(new n(Bt),e,t,!0)}function Yn(n){var e=n.length-1,t=e*E+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Se(n){for(var e="";n--;)e+="0";return e}function Jn(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/E+4);for(W=!1;;){if(t%2&&(o=o.times(e),Gn(o.d,s)&&(r=!0)),t=oe(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Gn(e.d,s)}return W=!0,o}function Un(n){return n.d[n.d.length-1]&1}function $n(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function rn(n,e){var t,i,r,o,s,a,c,u=0,l=0,m=0,d=n.constructor,p=d.rounding,b=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(W=!1,c=b):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),m+=5;for(i=Math.log(ee(2,m))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=R(o.times(n),c,1),t=t.times(++l),a=s.plus(X(o,t,c,1)),ie(a.d).slice(0,c)===ie(s.d).slice(0,c)){for(r=m;r--;)s=R(s.times(s),c,1);if(e==null)if(u<3&&et(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return R(s,d.precision=b,p,W=!0);else return d.precision=b,s}s=a}}function Ce(n,e){var t,i,r,o,s,a,c,u,l,m,d,p=1,b=10,f=n,g=f.d,k=f.constructor,A=k.rounding,P=k.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new k(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(W=!1,l=P):l=e,k.precision=l+=b,t=ie(g),i=t.charAt(0),Math.abs(o=f.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)f=f.times(n),t=ie(f.d),i=t.charAt(0),p++;o=f.e,i>1?(f=new k("0."+t),o++):f=new k(i+"."+t.slice(1))}else return u=It(k,l+2,P).times(o+""),f=Ce(new k(i+"."+t.slice(1)),l-b).plus(u),k.precision=P,e==null?R(f,P,A,W=!0):f;for(m=f,c=s=f=X(f.minus(1),f.plus(1),l,1),d=R(f.times(f),l,1),r=3;;){if(s=R(s.times(d),l,1),u=c.plus(X(s,new k(r),l,1)),ie(u.d).slice(0,l)===ie(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(It(k,l+2,P).times(o+""))),c=X(c,new k(p),l,1),e==null)if(et(c.d,l-b,A,a))k.precision=l+=b,u=s=f=X(m.minus(1),m.plus(1),l,1),d=R(f.times(f),l,1),r=a=1;else return R(c,k.precision=P,A,W=!0);else return k.precision=P,c;c=u,r+=2}}function ei(n){return String(n.s*n.s/0)}function on(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%E,t<0&&(i+=E),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=E;i<r;)n.d.push(+e.slice(i,i+=E));e=e.slice(i),i=E-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),W&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function lr(n,e){var t,i,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Qn.test(e))return on(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(or.test(e))t=16,e=e.toLowerCase();else if(rr.test(e))t=2;else if(sr.test(e))t=8;else throw Error(Ke+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Jn(i,new i(t),o,o*2)),u=Tt(e,t,be),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=St(u,l),n.d=u,W=!1,s&&(n=X(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?ee(2,c):tt.pow(2,c))),W=!0,n)}function mr(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:Ge(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/Ct(5,t)),e=Ge(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Ge(n,e,t,i,r){var o,s,a,c,u=1,l=n.precision,m=Math.ceil(l/E);for(W=!1,c=t.times(t),a=new n(i);;){if(s=X(a.times(c),new n(e++*e++),l,1),a=r?i.plus(s):i.minus(s),i=X(s.times(c),new n(e++*e++),l,1),s=a.plus(i),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return W=!0,s.d.length=m+1,s}function Ct(n,e){for(var t=n;--e;)t*=n;return t}function ti(n,e){var t,i=e.s<0,r=fe(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Be=i?4:1,e;if(t=e.divToInt(r),t.isZero())Be=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Be=Un(t)?i?2:3:i?4:1,e;Be=Un(t)?i?1:4:i?3:2}return e.minus(r).abs()}function sn(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor,b=t!==void 0;if(b?(ae(t,1,Ne),i===void 0?i=p.rounding:ae(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())l=ei(n);else{for(l=we(n),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Tt(we(d),10,r),d.e=d.d.length),m=Tt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=X(n,d,t,i,0,r),m=n.d,o=n.e,u=Hn),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&m[t-1]&1||i===(n.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=en.charAt(m[s]);if(b){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Tt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=en.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return n.s<0?"-"+l:l}function Gn(n,e){if(n.length>e)return n.length=e,!0}function dr(n){return new this(n).abs()}function pr(n){return new this(n).acos()}function fr(n){return new this(n).acosh()}function br(n,e){return new this(n).plus(e)}function gr(n){return new this(n).asin()}function yr(n){return new this(n).asinh()}function wr(n){return new this(n).atan()}function Pr(n){return new this(n).atanh()}function Ar(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=fe(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?fe(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=fe(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(X(n,e,o,1)),e=fe(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(X(n,e,o,1)),t}function kr(n){return new this(n).cbrt()}function Tr(n){return R(n=new this(n),n.e+1,2)}function hr(n,e,t){return new this(n).clamp(e,t)}function Br(n){if(!n||typeof n!="object")throw Error(xt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Ne,"rounding",0,8,"toExpNeg",-Ue,0,"toExpPos",0,Ue,"maxE",0,Ue,"minE",-Ue,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=tn[t]),(i=n[t])!==void 0)if(oe(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Ke+t+": "+i);if(t="crypto",r&&(this[t]=tn[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Zn);else this[t]=!1;else throw Error(Ke+t+": "+i);return this}function Ir(n){return new this(n).cos()}function xr(n){return new this(n).cosh()}function ni(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,Xn(o)){u.s=o.s,W?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;W?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return on(u,o.toString())}else if(c!=="string")throw Error(Ke+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Qn.test(o)?on(u,o):lr(u,o)}if(r.prototype=y,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Br,r.clone=ni,r.isDecimal=Xn,r.abs=dr,r.acos=pr,r.acosh=fr,r.add=br,r.asin=gr,r.asinh=yr,r.atan=wr,r.atanh=Pr,r.atan2=Ar,r.cbrt=kr,r.ceil=Tr,r.clamp=hr,r.cos=Ir,r.cosh=xr,r.div=Sr,r.exp=Cr,r.floor=Kr,r.hypot=Nr,r.ln=Lr,r.log=Rr,r.log10=Or,r.log2=Mr,r.max=Fr,r.min=Er,r.mod=vr,r.mul=Dr,r.pow=Wr,r.random=_r,r.round=Vr,r.sign=qr,r.sin=Ur,r.sinh=Gr,r.sqrt=Xr,r.sub=Hr,r.sum=zr,r.tan=Zr,r.tanh=jr,r.trunc=Qr,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function Sr(n,e){return new this(n).div(e)}function Cr(n){return new this(n).exp()}function Kr(n){return R(n=new this(n),n.e+1,3)}function Nr(){var n,e,t=new this(0);for(W=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return W=!0,new this(1/0);t=e}return W=!0,t.sqrt()}function Xn(n){return n instanceof tt||n&&n.toStringTag===jn||!1}function Lr(n){return new this(n).ln()}function Rr(n,e){return new this(n).log(e)}function Mr(n){return new this(n).log(2)}function Or(n){return new this(n).log(10)}function Fr(){return $n(this,arguments,"lt")}function Er(){return $n(this,arguments,"gt")}function vr(n,e){return new this(n).mod(e)}function Dr(n,e){return new this(n).mul(e)}function Wr(n,e){return new this(n).pow(e)}function _r(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:ae(n,1,Ne),i=Math.ceil(n/E),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(Zn);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=E,i&&n&&(r=ee(10,E-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=E)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<E&&(t-=E-i)}return s.e=t,s.d=a,s}function Vr(n){return R(n=new this(n),n.e+1,this.rounding)}function qr(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Ur(n){return new this(n).sin()}function Gr(n){return new this(n).sinh()}function Xr(n){return new this(n).sqrt()}function Hr(n,e){return new this(n).sub(e)}function zr(){var n=0,e=arguments,t=new this(e[n]);for(W=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return W=!0,R(t,this.precision,this.rounding)}function Zr(n){return new this(n).tan()}function jr(n){return new this(n).tanh()}function Qr(n){return R(n=new this(n),n.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var tt=y.constructor=ni(tn);ht=new tt(ht);Bt=new tt(Bt);var te=tt;import vo from"big.js";import Kc from"bn.js";import{get as ii,set as Yr}from"lodash";var an=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ri={},Jr={};function ne(n){let e=ii(ri,n);if(!e){let t=ii(Jr,n);e=new an({name:n,logLevel:t}),Yr(ri,n,e)}return e}import{PublicKey as oi}from"@solana/web3.js";import{MINT_SIZE as $r,TOKEN_PROGRAM_ID as eo,getTransferFeeConfig as to,unpackMint as no}from"@solana/spl-token";var un=ne("Raydium_accountInfo_util");async function nt(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=U({batchRequest:!1},t),s=cn(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=cn(c,10);a=(await(await Promise.all(u.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&un.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:b,lamports:f,owner:g,rentEpoch:k}=d;return p.length!==2&&p[1]!=="base64"&&un.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:b,lamports:f,owner:new oi(g),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&un.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Ee(n,e,t){let i=await nt(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>Z(U({},r),{accountInfo:i[o]}))}async function ln({connection:n,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let i=await Ee(n,e.map(c=>({pubkey:it(c)})),t),r={};for(let c of i){if(!c.accountInfo||c.accountInfo.data.length<$r){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=no(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=Z(U({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||eo,feeConfig:(a=to(u))!=null?a:void 0})}return r[oi.default.toBase58()]=r[ue.toBase58()],r}import rt from"bn.js";var si=9007199254740991;function Pe(n){let e=ne("Raydium_parseBigNumberish");if(n instanceof rt)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new rt(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=si||n<=-si)&&e.logWithError(`BigNumberish number overflow: ${n}`),new rt(String(n))):typeof n=="bigint"?new rt(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new rt(0))}import{PublicKey as io}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ai}from"@solana/spl-token";var mn={chainId:101,address:io.default.toBase58(),programId:ai.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ai.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as fn}from"@solana/web3.js";import{PublicKey as Q,SystemProgram as ui,SYSVAR_RENT_PUBKEY as ro}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as oo}from"@solana/spl-token";function dn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Zs=[dn({pubkey:oo,isWritable:!1}),dn({pubkey:ui.programId,isWritable:!1}),dn({pubkey:ro,isWritable:!1})];function pn({publicKey:n,transformSol:e}){let t=ci(n.toString());if(t instanceof Q)return e&&t.equals(ot)?ue:t;if(e&&t.toString()===ot.toBase58())return ue;if(typeof t=="string"){if(t===Q.default.toBase58())return Q.default;try{return new Q(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ci(n){try{return new Q(n)}catch{return n}}var so=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Kt=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Nt=new Q("SysvarRent111111111111111111111111111111111"),js=new Q("SysvarC1ock11111111111111111111111111111111"),Xe=new Q("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Qs=new Q("Sysvar1nstructions1111111111111111111111111"),li=ui.programId,Ys=new Q("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Js=new Q("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),$s=new Q("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ea=new Q("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ta=new Q("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),na=new Q("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ia=new Q("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ra=new Q("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),oa=new Q("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),sa=new Q("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),aa=new Q("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ue=new Q("So11111111111111111111111111111111111111112"),ot=Q.default;function it(n){return pn({publicKey:n,transformSol:!0})}var bn=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===ot.toBase58()||e instanceof fn&&ot.equals(e)){this.decimals=Le.decimals,this.symbol=Le.symbol,this.name=Le.name,this.mint=new fn(Le.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?fn.default:pn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Re=bn;Re.WSOL=new bn(Z(U({},Le),{mint:Le.address}));var gn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},Lt=gn;Lt.SOL=new gn(mn);import ao from"toformat";var uo=ao,st=uo;import Mt from"big.js";import lo from"bn.js";import mo from"decimal.js-light";var Rt=ne("module/fraction"),yn=st(Mt),at=st(mo),po={[0]:at.ROUND_DOWN,[1]:at.ROUND_HALF_UP,[2]:at.ROUND_UP},fo={[0]:Mt.roundDown,[1]:Mt.roundHalfUp,[2]:Mt.roundUp},z=class{constructor(e,t=new lo(1)){this.numerator=Pe(e),this.denominator=Pe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new z(this.denominator,this.numerator)}add(e){let t=e instanceof z?e:new z(Pe(e));return this.denominator.eq(t.denominator)?new z(this.numerator.add(t.numerator),this.denominator):new z(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof z?e:new z(Pe(e));return this.denominator.eq(t.denominator)?new z(this.numerator.sub(t.numerator),this.denominator):new z(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof z?e:new z(Pe(e));return new z(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof z?e:new z(Pe(e));return new z(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||Rt.logWithError(`${e} is not an integer.`),e<=0&&Rt.logWithError(`${e} is not positive.`),at.set({precision:e+1,rounding:po[i]});let r=new at(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||Rt.logWithError(`${e} is not an integer.`),e<0&&Rt.logWithError(`${e} is negative.`),yn.DP=e,yn.RM=fo[i]||1,new yn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import bo from"bn.js";var mi=new z(new bo(100)),le=class extends z{toSignificant(e=5,t,i){return this.mul(mi).toSignificant(e,t,i)}toFixed(e=2,t,i){return this.mul(mi).toFixed(e,t,i)}};var Oa=ne("Raydium_price");function cn(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as To}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ho}from"@solana/spl-token";import{ComputeBudgetProgram as di,Keypair as fi,PublicKey as go,Transaction as bi,TransactionMessage as yo,VersionedTransaction as gi}from"@solana/web3.js";var re={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as wo}from"@solana/spl-token";var pi=ne("Raydium_txUtil"),yi=1644;function Ft(n){let e=[],t=[];return n.microLamports&&(e.push(di.setComputeUnitPrice({microLamports:n.microLamports})),t.push(re.SetComputeUnitPrice)),n.units&&(e.push(di.setComputeUnitLimit({units:n.units})),t.push(re.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function He(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function Et(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(Object.assign(o.err,{txId:e}))},"confirmed")})}function Po(n,e){n.length<1&&pi.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&pi.logWithError(`no signers provided:, ${e.toString()}`);let t=new bi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<yi}catch{return!1}}function ge(n,e){let[t,i]=go.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function ut({instructions:n,payer:e,signers:t}){return Po(n,[e,...t])}function ct({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=fi.generate().publicKey.toString()}){let o=new yo({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new gi(o).serialize()).toString("base64").length<yi}catch{return!1}}var Ao=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),ko=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof gi&&(e=Ao(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ve(n){let e=[];return n.forEach(t=>{t instanceof bi&&(t.recentBlockhash||(t.recentBlockhash=wo.toBase58()),t.feePayer||(t.feePayer=fi.generate().publicKey)),e.push(ko(t))}),console.log("simulate tx string:",e),e}function me(n,e,t){return ge([n.toBuffer(),(t!=null?t:ho).toBuffer(),e.toBuffer()],new To("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as _}from"@solana/web3.js";var fu=new _("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),bu=new _("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),gu=new _("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),yu=new _("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),wu=new _("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Pu=new _("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Au=new _("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ku=new _("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Tu=new _("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),hu=new _("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Bo=new _("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Io=new _("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),xo=new _("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Bu=new _("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Iu=new _("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),xu=new _("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Su=new _("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Cu=new _("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ku=new _("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),wi=new _("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Pi=new _("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Nu=new _("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),So=new _("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Co=new _("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Ko=new _("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),vt=new _("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),No=new _("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Dt=new _("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Lo=new _("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Lu=new _("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ru=new _("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ro=new _("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Mo=new _("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var Mu={AMM_V4:new _("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AMM_STABLE:new _("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM_PROGRAM_ID:new _("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new _("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new _("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),FARM_PROGRAM_ID_V3:new _("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FARM_PROGRAM_ID_V5:new _("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FARM_PROGRAM_ID_V6:new _("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),OPEN_BOOK_PROGRAM:new _("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:_.default,UTIL1216:_.default,Router:new _("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:So,CREATE_CPMM_POOL_AUTH:Co,CREATE_CPMM_POOL_FEE_ACC:Ko,LOCK_CPMM_PROGRAM:No,LOCK_CPMM_AUTH:Lo,LAUNCHPAD_PROGRAM:Ro,LAUNCHPAD_AUTH:Mo,FEE_DESTINATION_ID:new _("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import ye from"bn.js";var lt=1e4;function Ae(n,e,t,i){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let r=Z(U({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ye(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(i)if(o.transferFeeBasisPoints===lt){let c=new ye(o.maximumFee.toString());return{amount:n.add(c),fee:c,expirationTime:a}}else{let c=ze(n.mul(new ye(lt)),new ye(lt-o.transferFeeBasisPoints)),u=new ye(o.maximumFee.toString()),l=c.sub(n).gt(u)?n.add(u):c,m=ze(l.mul(new ye(o.transferFeeBasisPoints)),new ye(lt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=ze(n.mul(new ye(o.transferFeeBasisPoints)),new ye(lt)),u=c.gt(s)?s:c;return{amount:n,fee:u,expirationTime:a}}}function ze(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new ye(0))?t.add(new ye(1)):t}import{PublicKey as Ai,AddressLookupTableAccount as Wt}from"@solana/web3.js";async function An({connection:n,address:e}){let t=await nt(n,[...new Set(e.map(r=>r.toString()))].map(r=>new Ai(r))),i={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Wt({key:s,state:Wt.deserialize(o.data)});i[s.toString()]=a,_t[s.toString()]=a}return i}var _t={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Wt({key:new Ai("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Wt.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as Ze,sendAndConfirmTransaction as kn,SystemProgram as Oo,Transaction as mt,TransactionMessage as dt,VersionedTransaction as pt}from"@solana/web3.js";import Fo from"axios";var Vt=2e3,qt=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Fo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Ft(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Oo.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Ze(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(re.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ze.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(U({},t||{})):this.build(t)}build(e){var i;let t=new mt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o!=null?o:await He(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),ve([t]),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await kn(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let d of m)try{d.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var k;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:b,skipPreflight:f=!0}=l||{},g=b!=null?b:await He(this.connection,this.blockhashCommitment);if((k=this.owner)!=null&&k.isKeyPair){if(m){let A=[],P=0;for(let w of s){if(++P,P<=p)continue;let h=await kn(this.connection,w,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(h)}return{txIds:A,signedTxs:s}}return{txIds:await await Promise.all(s.map(async A=>(A.recentBlockhash=g,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let A=s.map((w,h)=>(w.recentBlockhash=g,a[h].length&&w.sign(...a[h]),w));ve(A);let P=await this.signAllTransactions(A);if(m){let w=0,h=[],T=async()=>{if(!P[w])return;let I=await this.connection.sendRawTransaction(P[w].serialize(),{skipPreflight:f});h.push({txId:I,status:"sent",signedTx:P[w]}),d==null||d([...h]),w++;let x=!1,K=null,S=null,M=F=>{K!==null&&clearInterval(K),S!==null&&this.connection.removeSignatureListener(S);let D=h.findIndex(q=>q.txId===I);if(D>-1){if(h[D].status==="error"||h[D].status==="success")return;h[D].status=F.err?"error":"success"}d==null||d([...h]),F.err||T()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var F;if(x){clearInterval(K);return}try{let D=await this.connection.getTransaction(I,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(x=!0,clearInterval(K),M({err:((F=D.meta)==null?void 0:F.err)||null}),console.log("tx status from getTransaction:",I))}catch(D){x=!0,clearInterval(K),console.error("getTransaction timeout:",D,I)}},Vt)),S=this.connection.onSignature(I,F=>{if(x){this.connection.removeSignatureListener(S);return}x=!0,M(F)},"confirmed"),this.connection.getSignatureStatus(I)};return await T(),{txIds:h.map(I=>I.txId),signedTxs:P}}else{let w=[];for(let h=0;h<P.length;h+=1){let T=await this.connection.sendRawTransaction(P[h].serialize(),{skipPreflight:f});w.push(T)}return{txIds:w,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var f;let b=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=b,s=he(b,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=U(U({},this.cluster==="devnet"?{}:_t),t),c=Array.from(new Set([...i,...this.lookupTableAddress])),u=[];for(let g of c)a[g]===void 0&&u.push(new Ze(g));let l=await An({connection:this.connection,address:u});for(let[g,k]of Object.entries(l))a[g]=k;let m=r?Ze.default.toBase58():o!=null?o:await He(this.connection,this.blockhashCommitment),d=new dt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new pt(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var w;let{skipPreflight:k=!0,sendAndConfirm:A,notSendToRpc:P}=g||{};if(ve([p]),(w=this.owner)!=null&&w.isKeyPair){let h=await this.connection.sendTransaction(p,{skipPreflight:k});return A&&await Et(this.connection,h),{txId:h,signedTx:p}}if(this.signAllTransactions){let h=await this.signAllTransactions([p]);if(this.signers.length)for(let T of h)try{T.sign(this.signers)}catch{}return{txId:P?"":await this.connection.sendTransaction(h[0],{skipPreflight:k}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:b=!0}=l||{};if(p&&s.forEach(g=>g.message.recentBlockhash=p),ve(s),(f=this.owner)!=null&&f.isKeyPair){if(m){let g=[];for(let k of s){let A=await this.connection.sendTransaction(k,{skipPreflight:b});await Et(this.connection,A),g.push(A)}return{txIds:g,signedTxs:s}}return{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(m){let k=0,A=[],P=async()=>{if(!g[k])return;let w=await this.connection.sendTransaction(g[k],{skipPreflight:b});A.push({txId:w,status:"sent",signedTx:g[k]}),d==null||d([...A]),k++;let h=!1,T=null,I=null,x=K=>{T!==null&&clearInterval(T),I!==null&&this.connection.removeSignatureListener(I);let S=A.findIndex(M=>M.txId===w);if(S>-1){if(A[S].status==="error"||A[S].status==="success")return;A[S].status=K.err?"error":"success"}d==null||d([...A]),K.err||P()};this.loopMultiTxStatus&&(T=setInterval(async()=>{var K;if(h){clearInterval(T);return}try{let S=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});S&&(h=!0,clearInterval(T),x({err:((K=S.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",w))}catch(S){h=!0,clearInterval(T),console.error("getTransaction timeout:",S,w)}},Vt)),I=this.connection.onSignature(w,K=>{if(h){this.connection.removeSignatureListener(I);return}h=!0,x(K)},"confirmed"),this.connection.getSignatureStatus(w)};return P(),{txIds:[],signedTxs:g}}else{let k=[];for(let A=0;A<g.length;A+=1){let P=await this.connection.sendTransaction(g[A],{skipPreflight:b});k.push(P)}return{txIds:k,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:i}=m,r=he(m,["splitIns","computeBudgetConfig"]),o=i?Ft(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,b)=>Z(U({},p),{[b.publicKey.toBase58()]:b}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(p=>{let b=[...u,p],f=i?[...o.instructions,...b]:b,k=[...new Set(b.map(A=>A.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(A=>new Ze(A));if(p!==t[l]&&u.length<12&&(ut({instructions:f,payer:this.feePayer,signers:k})||ut({instructions:b,payer:this.feePayer,signers:k})))u.push(p);else{if(u.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,ut({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:k})?a.push(new mt().add(...o.instructions,...u)):a.push(new mt().add(...u)),c.push(Array.from(new Set(u.map(A=>A.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat())).map(A=>s[A]).filter(A=>A!==void 0)),u=[p]}}),u.length>0){let b=[...new Set(u.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);ut({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:b.map(f=>f.publicKey)})?a.push(new mt().add(...o.instructions,...u)):a.push(new mt().add(...u)),c.push(b)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(p=>{p.some(b=>b.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var w;let{sequentially:b,onTxUpdate:f,skipTxCount:g=0,recentBlockHash:k,skipPreflight:A=!0}=p||{},P=k!=null?k:await He(this.connection,this.blockhashCommitment);if(a.forEach(async(h,T)=>{h.recentBlockhash=P,c[T].length&&h.sign(...c[T])}),ve(a),(w=this.owner)!=null&&w.isKeyPair){if(b){let h=0,T=[];for(let I of a){if(++h,h<=g){T.push("tx skipped");continue}let x=await kn(this.connection,I,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});T.push(x)}return{txIds:T,signedTxs:a}}return{txIds:await Promise.all(a.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:A}))),signedTxs:a}}if(this.signAllTransactions){let h=await this.signAllTransactions(a.slice(g,a.length)),T=[...a.slice(0,g),...h];if(b){let I=0,x=[],K=async()=>{if(!T[I])return;I<g&&(x.push({txId:"",status:"success",signedTx:T[I]}),f==null||f([...x]),I++,K());let S=await this.connection.sendRawTransaction(T[I].serialize(),{skipPreflight:A});x.push({txId:S,status:"sent",signedTx:T[I]}),f==null||f([...x]),I++;let M=!1,F=null,D=null,q=v=>{F!==null&&clearInterval(F),D!==null&&this.connection.removeSignatureListener(D);let O=x.findIndex($=>$.txId===S);if(O>-1){if(x[O].status==="error"||x[O].status==="success")return;x[O].status=v.err?"error":"success"}f==null||f([...x]),v.err||K()};this.loopMultiTxStatus&&(F=setInterval(async()=>{var v;if(M){clearInterval(F);return}try{let O=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(M=!0,clearInterval(F),q({err:((v=O.meta)==null?void 0:v.err)||null}),console.log("tx status from getTransaction:",S))}catch(O){M=!0,clearInterval(F),console.error("getTransaction timeout:",O,S)}},Vt)),D=this.connection.onSignature(S,v=>{if(M){this.connection.removeSignatureListener(D);return}M=!0,q(v)},"confirmed"),this.connection.getSignatureStatus(S)};return await K(),{txIds:x.map(S=>S.txId),signedTxs:T}}else{let I=[];for(let x=0;x<T.length;x+=1){let K=await this.connection.sendRawTransaction(T[x].serialize(),{skipPreflight:A});I.push(K)}return{txIds:I,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var P;let A=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=A,s=he(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=U(U({},this.cluster==="devnet"?{}:_t),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let w of c)a[w]===void 0&&u.push(new Ze(w));let l=await An({connection:this.connection,address:u});for(let[w,h]of Object.entries(l))a[w]=h;let m=t?Ft(t):{instructions:[],instructionTypes:[]},d=await He(this.connection,this.blockhashCommitment),p=this.signers.reduce((w,h)=>Z(U({},w),{[h.publicKey.toBase58()]:h}),{}),b=[],f=[],g=[],k=0;if(this.allInstructions.forEach(w=>{let h=[...g,w],T=t?[...m.instructions,...h]:h;if(w!==i[k]&&g.length<12&&(ct({instructions:T,payer:this.feePayer,lookupTableAddressAccount:a})||ct({instructions:h,payer:this.feePayer,lookupTableAddressAccount:a})))g.push(w);else{if(g.length===0)throw Error("item ins too big");k+=w===i[k]?1:0;let I={};for(let x of[...new Set(c)])a[x]!==void 0&&(I[x]=a[x]);if(t&&ct({instructions:[...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let x=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...g]}).compileToV0Message(Object.values(a));b.push(new pt(x))}else{let x=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(a));b.push(new pt(x))}f.push(Array.from(new Set(g.map(x=>x.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(x=>p[x]).filter(x=>x!==void 0)),g=[w]}}),g.length>0){let h=[...new Set(g.map(T=>T.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(T=>p[T]).filter(T=>T!==void 0);if(t&&ct({instructions:[...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let T=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...g]}).compileToV0Message(Object.values(a));b.push(new pt(T))}else{let T=new dt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(a));b.push(new pt(T))}f.push(h)}return(P=this.owner)!=null&&P.signer&&f.forEach(w=>{w.some(h=>h.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),b.forEach((w,h)=>{w.sign(f[h])}),{builder:this,transactions:b,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async w=>{var S;let{sequentially:h,onTxUpdate:T,skipTxCount:I=0,recentBlockHash:x,skipPreflight:K=!0}=w||{};if(b.map(async(M,F)=>{f[F].length&&M.sign(f[F]),x&&(M.message.recentBlockhash=x)}),ve(b),(S=this.owner)!=null&&S.isKeyPair){if(h){let M=0,F=[];for(let D of b){if(++M,M<=I){console.log("skip tx: ",M),F.push("tx skipped");continue}let q=await this.connection.sendTransaction(D,{skipPreflight:K});await Et(this.connection,q),F.push(q)}return{txIds:F,signedTxs:b}}return{txIds:await Promise.all(b.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:K}))),signedTxs:b}}if(this.signAllTransactions){let M=await this.signAllTransactions(b.slice(I,b.length)),F=[...b.slice(0,I),...M];if(h){let D=0,q=[],v=async()=>{if(!F[D])return;if(D<I){q.push({txId:"",status:"success",signedTx:F[D]}),T==null||T([...q]),D++,v();return}let O=await this.connection.sendTransaction(F[D],{skipPreflight:K});q.push({txId:O,status:"sent",signedTx:F[D]}),T==null||T([...q]),D++;let $=!1,pe=null,Oe=null,Wn=Fe=>{pe!==null&&clearInterval(pe),Oe!==null&&this.connection.removeSignatureListener(Oe);let Te=q.findIndex(er=>er.txId===O);if(Te>-1){if(q[Te].status==="error"||q[Te].status==="success")return;q[Te].status=Fe.err?"error":"success"}T==null||T([...q]),Fe.err||v()};this.loopMultiTxStatus&&(pe=setInterval(async()=>{var Fe;if($){clearInterval(pe);return}try{let Te=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});Te&&($=!0,clearInterval(pe),Wn({err:((Fe=Te.meta)==null?void 0:Fe.err)||null}),console.log("tx status from getTransaction:",O))}catch(Te){$=!0,clearInterval(pe),console.error("getTransaction timeout:",Te,O)}},Vt)),Oe=this.connection.onSignature(O,Fe=>{if($){this.connection.removeSignatureListener(Oe);return}$=!0,Wn(Fe)},"confirmed"),this.connection.getSignatureStatus(O)};return v(),{txIds:[],signedTxs:F}}else{let D=[];for(let q=0;q<F.length;q+=1){let v=await this.connection.sendTransaction(F[q],{skipPreflight:K});D.push(v)}return{txIds:D,signedTxs:F}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{PublicKey as ec}from"@solana/web3.js";import nc from"bn.js";import Eo from"bn.js";var Ut=new Eo(1e6);var Dc=ne("Raydium_amount"),Wc=st(vo);var Pn=new ke(0),tl=new ke(1),nl=new ke(2),il=new ke(3),rl=new ke(5),Do=new ke(10),ol=new ke(100),sl=new ke(1e3),al=new ke(1e4);function Ti(n,e,t){return n.mul(e).add(t).sub(new ke(1)).div(t)}function Tn(n,e,t){return n.mul(e).div(t)}import hn from"bn.js";import zt from"decimal.js-light";import ft from"bn.js";function Gt(n,e){if(e.isZero())throw Error("divisor is zero");return n.mod(e)}function Wo(n,e){if(e.isZero())throw Error("rhs is zero");let t=n.div(e);if(t.isZero())throw Error("quotient is zero");let i=Gt(n,e);return i.gt(je)&&(t=t.add(new ft(1)),e=n.div(t),i=Gt(n,t),i.gt(je)&&(e=e.add(new ft(1)))),[t,e]}var je=new ft(0),Xt=class{static swapWithoutFees(e,t,i){let r=t.mul(i),o=t.add(e),[s]=Wo(r,o),a=i.sub(s);if(a.isZero())throw Error("destinationAmountSwapped is zero");return{destinationAmountSwapped:a}}static lpTokensToTradingTokens(e,t,i,r,o){let s=e.mul(i).div(t),a=e.mul(r).div(t);if(o===0)return{tokenAmount0:s,tokenAmount1:a};if(o===1)return Gt(e.mul(i),t).gt(je)&&s.gt(je)&&(s=s.add(new ft(1))),Gt(e.mul(r),t).gt(je)&&a.gt(je)&&(a=a.add(new ft(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};var Ht=class{static tradingFee(e,t){return Ti(e,t,Ut)}static protocolFee(e,t){return Tn(e,t,Ut)}static fundFee(e,t){return Tn(e,t,Ut)}};var Zt=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,i,r){let o=Ht.tradingFee(e,r),s=e.sub(o),{destinationAmountSwapped:a}=Xt.swapWithoutFees(s,t,i);return{newSwapDestinationAmount:i.sub(a),sourceAmountSwapped:e,destinationAmountSwapped:a,tradeFee:o}}static swapBaseOut({poolMintA:e,poolMintB:t,tradeFeeRate:i,baseReserve:r,quoteReserve:o,outputMint:s,outputAmount:a}){let[c,u,l,m,d]=t.address===s.toString()?[r,o,e.decimals,t.decimals,e.address]:[o,r,t.decimals,e.decimals,t.address],p=new zt(u.toString()).div(10**m).div(new zt(c.toString()).div(10**l)),b=a.gte(u)?u.sub(new hn(1)):a,f=u.sub(b),g=ze(c.mul(b),f),k=ze(g.mul(new hn(1e6)),new hn(1e6).sub(i)),A=k.sub(g),P=new zt(b.toString()).div(10**m).div(new zt(k.toString()).div(10**l)),w=p.isZero()?0:P.sub(p).div(p).abs().toNumber();return{amountRealOut:b,amountIn:k,amountInWithoutFee:g,tradeFee:A,priceImpact:w}}};import J from"bn.js";var Bn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Qe=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ne(t)}createTxBuilder(e){return this.scope.checkOwner(),new qt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Bn(e))}logInfo(...e){this.logger.info(Bn(e))}logAndCreateError(...e){let t=Bn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Zo}from"@solana/web3.js";import xi,{isBN as Si}from"bn.js";import{bits as Kl,BitStructure as Nl,blob as _o,Blob as Ll,cstr as Rl,f32 as Ml,f32be as Ol,f64 as Fl,f64be as El,greedy as vl,Layout as Vo,ns64 as Dl,ns64be as Wl,nu64 as _l,nu64be as Vl,offset as ql,s16 as Ul,s16be as Gl,s24 as Xl,s24be as Hl,s32 as qo,s32be as zl,s40 as Zl,s40be as jl,s48 as Ql,s48be as Yl,s8 as Jl,seq as Uo,struct as $l,Structure as Go,u16 as Xo,u16be as em,u24 as tm,u24be as nm,u32 as im,u32be as rm,u40 as om,u40be as sm,u48 as am,u48be as um,u8 as Ho,UInt as zo,union as cm,Union as lm,unionLayoutDiscriminator as mm,utf8 as dm}from"@solana/buffer-layout";var In=Vo,hi=Go;var xn=zo;var Bi=Ho,De=Xo;var Ie=qo;var Ii=Uo;var se=_o;var Ye=class extends In{constructor(t,i,r){super(t,r);this.blob=se(t),this.signed=i}decode(t,i=0){let r=new xi(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new xi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function j(n){return new xn(1,n)}function xe(n){return new xn(4,n)}function C(n){return new Ye(8,!1,n)}function Y(n){return new Ye(16,!1,n)}function Ci(n){return new Ye(8,!0,n)}function Ki(n){return new Ye(16,!0,n)}var jt=class extends In{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function V(n){return new jt(se(32),e=>new Zo(e),e=>e.toBuffer(),n)}function We(n){return new jt(Bi(),jo,Qo,n)}function jo(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Qo(n){return n?1:0}var Sn=class extends hi{decode(e,t){return super.decode(e,t)}};function G(n,e,t){return new Sn(n,e,t)}function H(n,e,t){let i,r=typeof e=="number"?e:Si(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=Si(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return Ii(n,r,t)}var xm=G([xe("mintAuthorityOption"),V("mintAuthority"),C("supply"),j("decimals"),j("isInitialized"),xe("freezeAuthorityOption"),V("freezeAuthority")]);import{PublicKey as Nm}from"@solana/web3.js";import{MintLayout as Rm,TOKEN_PROGRAM_ID as Om}from"@solana/spl-token";var _e=r=>{var o=r,{address:n,programId:e,decimals:t}=o,i=he(o,["address","programId","decimals"]);return U({chainId:101,address:it(n).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:i.extensions||{}},i)},Je=n=>n?Z(U({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:Z(U({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:Z(U({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;import{PublicKey as At,TransactionInstruction as Ve,Keypair as As,SystemProgram as ks}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Gi,TOKEN_2022_PROGRAM_ID as En,TOKEN_PROGRAM_ID as Me}from"@solana/spl-token";var Yo=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Hm=Buffer.from("amm_config","utf8"),Jo=Buffer.from("pool","utf8"),$o=Buffer.from("pool_lp_mint","utf8"),es=Buffer.from("pool_vault","utf8"),ts=Buffer.from("observation","utf8");function Qt(n){return ge([Yo],n)}function Cn(n,e,t,i){return ge([Jo,e.toBuffer(),t.toBuffer(),i.toBuffer()],n)}function ns(n,e){return ge([$o,e.toBuffer()],n)}function Ni(n,e,t){return ge([es,e.toBuffer(),t.toBuffer()],n)}function bt(n,e){return ge([ts,e.toBuffer()],n)}function Li({poolId:n,programId:e,configId:t,mintA:i,mintB:r}){let o=Qt(e).publicKey,s=n||Cn(e,t,i,r).publicKey,a=ns(e,s).publicKey,c=Ni(e,s,i).publicKey,u=Ni(e,s,r).publicKey,l=bt(e,s).publicKey;return{poolId:s,configId:t,authority:o,lpMint:a,vaultA:c,vaultB:u,observationId:l}}var is=Buffer.from("locked_liquidity","utf8");function gt(n,e){return ge([is,e.toBuffer()],n)}import{PublicKey as Sf}from"@solana/web3.js";import Kf from"bn.js";import{AccountLayout as Mf,createAssociatedTokenAccountIdempotentInstruction as Of,TOKEN_2022_PROGRAM_ID as Ff,TOKEN_PROGRAM_ID as Ef}from"@solana/spl-token";import{Keypair as $p,PublicKey as ef,SystemProgram as nf,TransactionInstruction as rf}from"@solana/web3.js";import sf from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as cf,TOKEN_2022_PROGRAM_ID as lf,TOKEN_PROGRAM_ID as mf}from"@solana/spl-token";import Mp from"bn.js";import de from"bn.js";var Kn=new de(0),Ri=new de(1),Mi=new de(-1),Yt=new de(1).shln(64),Oi=new de(1).shln(128),rs=Yt.sub(Ri);var os=Oi.subn(1),$e=-443636,yt=-$e,Nn=new de("4295048016"),Ln=new de("79226673521066979257578248091"),jm=new de("4295048017"),Qm=new de("79226673521066979257578248090");var ss=new de(10).pow(new de(6));var Ym=new de("18446744073700000000");import Pp from"bn.js";var rd=Buffer.from("amm_config","utf8"),od=Buffer.from("pool","utf8"),sd=Buffer.from("pool_vault","utf8"),ad=Buffer.from("pool_reward_vault","utf8"),ud=Buffer.from("position","utf8"),cd=Buffer.from("tick_array","utf8"),ld=Buffer.from("operation","utf8"),md=Buffer.from("pool_tick_array_bitmap_extension","utf8"),dd=Buffer.from("observation","utf8");function Rn(n){return ge([Buffer.from("metadata","utf8"),Xe.toBuffer(),n.toBuffer()],Xe)}var pd=Buffer.from("locked_position","utf8");var fd=Buffer.from("support_mint","utf8");import{PublicKey as zd}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as jd}from"@solana/spl-token";import Yd from"bn.js";import yd from"bn.js";var Fn=14;var Jt=60;var ls=G([se(8),j("bump"),De("index"),V(""),xe("protocolFeeRate"),xe("tradeFeeRate"),De("tickSpacing"),H(C(),8,"")]),ms=G([xe("blockTimestamp"),Ci("tickCumulative"),H(C(),4)]),Ui=G([se(8),We("initialized"),C("recentEpoch"),De("observationIndex"),V("poolId"),H(ms,100,"observations"),H(C(),4)]),ds=G([j("rewardState"),C("openTime"),C("endTime"),C("lastUpdateTime"),Y("emissionsPerSecondX64"),C("rewardTotalEmissioned"),C("rewardClaimed"),V("tokenMint"),V("tokenVault"),V("creator"),Y("rewardGrowthGlobalX64")]),_i=G([se(8),j("bump"),V("ammConfig"),V("creator"),V("mintA"),V("mintB"),V("vaultA"),V("vaultB"),V("observationId"),j("mintDecimalsA"),j("mintDecimalsB"),De("tickSpacing"),Y("liquidity"),Y("sqrtPriceX64"),Ie("tickCurrent"),xe(),Y("feeGrowthGlobalX64A"),Y("feeGrowthGlobalX64B"),C("protocolFeesTokenA"),C("protocolFeesTokenB"),Y("swapInAmountTokenA"),Y("swapOutAmountTokenB"),Y("swapInAmountTokenB"),Y("swapOutAmountTokenA"),j("status"),H(j(),7,""),H(ds,3,"rewardInfos"),H(C(),16,"tickArrayBitmap"),C("totalFeesTokenA"),C("totalFeesClaimedTokenA"),C("totalFeesTokenB"),C("totalFeesClaimedTokenB"),C("fundFeesTokenA"),C("fundFeesTokenB"),C("startTime"),H(C(),15*4-3,"padding")]),ps=G([Y("growthInsideLastX64"),C("rewardAmountOwed")]),Vi=G([se(8),j("bump"),V("nftMint"),V("poolId"),Ie("tickLower"),Ie("tickUpper"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),C("tokenFeesOwedA"),C("tokenFeesOwedB"),H(ps,3,"rewardInfos"),H(C(),8,"")]),Up=G([se(8),j("bump"),V("poolId"),Ie("tickLowerIndex"),Ie("tickUpperIndex"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),C("tokenFeesOwedA"),C("tokenFeesOwedB"),H(Y(),3,"rewardGrowthInside"),H(C(),8,"")]),fs=G([Ie("tick"),Ki("liquidityNet"),Y("liquidityGross"),Y("feeGrowthOutsideX64A"),Y("feeGrowthOutsideX64B"),H(Y(),3,"rewardGrowthsOutsideX64"),H(xe(),13,"")]),vi=G([se(8),V("poolId"),Ie("startTickIndex"),H(fs,Jt,"ticks"),j("initializedTickCount"),H(j(),115,"")]),bs=G([se(329),H(V(),100,"whitelistMints")]),cs=G([se(8),V("poolId"),H(H(C(),8),Fn,"positiveTickArrayBitmap"),H(H(C(),8),Fn,"negativeTickArrayBitmap")]),Gp=G([C(),j("bump"),V("owner"),V("poolId"),V("positionId"),V("nftAccount"),H(C(),8)]),gs=G([se(8),j("bump"),V("lockOwner"),V("poolId"),V("positionId"),V("nftAccount"),V("lockNftMint"),C("recentEpoch"),H(C(),8)]);Ui.span;var Af=ne("Raydium_Clmm");var Ts=ne("Raydium_cpmm"),qe={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function Xi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f,g,k,A,P){let w=G([C("amountMaxA"),C("amountMaxB"),C("openTime")]),h=Cn(n,t,o,s).publicKey,T=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!r.equals(h),isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:Gi,isSigner:!1,isWritable:!1},{pubkey:li,isSigner:!1,isWritable:!1},{pubkey:Nt,isSigner:!1,isWritable:!1}],I=Buffer.alloc(w.span);return w.encode({amountMaxA:k,amountMaxB:A,openTime:P},I),new Ve({keys:T,programId:n,data:Buffer.from([...qe.initialize,...I])})}function Hi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b){let f=G([C("lpAmount"),C("amountMaxA"),C("amountMaxB")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:En,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0}],k=Buffer.alloc(f.span);return Ts.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:p.toString(),amountMaxB:b.toString()}),f.encode({lpAmount:d,amountMaxA:p,amountMaxB:b},k),new Ve({keys:g,programId:n,data:Buffer.from([...qe.deposit,...k])})}function zi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b){let f=G([C("lpAmount"),C("amountMinA"),C("amountMinB")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:En,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Kt,isSigner:!1,isWritable:!1}],k=Buffer.alloc(f.span);return f.encode({lpAmount:d,amountMinA:p,amountMinB:b},k),new Ve({keys:g,programId:n,data:Buffer.from([...qe.withdraw,...k])})}function Zi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f){let g=G([C("amountIn"),C("amounOutMin")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],A=Buffer.alloc(g.span);return g.encode({amountIn:b,amounOutMin:f},A),new Ve({keys:k,programId:n,data:Buffer.from([...qe.swapBaseInput,...A])})}function ji(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f){let g=G([C("amountInMax"),C("amountOut")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],A=Buffer.alloc(g.span);return g.encode({amountInMax:b,amountOut:f},A),new Ve({keys:k,programId:n,data:Buffer.from([...qe.swapBaseOutput,...A])})}async function Qi(n){var g;let{ownerInfo:e,poolInfo:t,poolKeys:i,feeNftOwner:r,getEphemeralSigners:o}=n,s=[],[a,c]=[new At(t.id),new At(t.lpMint.address)],u;if(o)u=new At((await o(1))[0]);else{let k=As.generate();s.push(k),u=k.publicKey}let{publicKey:l}=me(r,u,Me),{publicKey:m}=Rn(u),{publicKey:d}=gt(n.lockProgram,u),{publicKey:p}=me(e.wallet,c,Me),{publicKey:b}=me(n.lockAuthProgram,c,Me),f=hs({programId:n.lockProgram,auth:n.lockAuthProgram,payer:e.feePayer,liquidityOwner:e.wallet,nftOwner:r,nftMint:u,nftAccount:l,poolId:a,lockPda:d,mintLp:c,userLpVault:p,lockLpVault:b,poolVaultA:new At(i.vault.A),poolVaultB:new At(i.vault.B),metadataAccount:m,lpAmount:n.lpAmount,withMetadata:(g=n.withMetadata)!=null?g:!0});return{address:{nftMint:u,nftAccount:l,metadataAccount:m,lockPda:d,userLpVault:p,lockLpVault:b},instructions:[f],signers:s,instructionTypes:[re.CpmmLockLp],lookupTableAddress:[]}}function hs({programId:n,auth:e,payer:t,liquidityOwner:i,nftOwner:r,nftMint:o,nftAccount:s,poolId:a,lockPda:c,mintLp:u,userLpVault:l,lockLpVault:m,poolVaultA:d,poolVaultB:p,metadataAccount:b,lpAmount:f,withMetadata:g}){let k=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:ks.programId,isSigner:!1,isWritable:!1},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:Gi,isSigner:!1,isWritable:!1},{pubkey:Xe,isSigner:!1,isWritable:!1}],A=G([C("lpAmount"),We("withMetadata")]),P=Buffer.alloc(A.span);A.encode({lpAmount:f,withMetadata:g},P);let w=Buffer.from([...qe.lockCpLiquidity,...P]);return new Ve({keys:k,programId:n,data:w})}function vn({programId:n,nftOwner:e,auth:t,nftAccount:i,lockPda:r,poolId:o,mintLp:s,userVaultA:a,userVaultB:c,poolVaultA:u,poolVaultB:l,mintA:m,mintB:d,lockLpVault:p,lpFeeAmount:b,cpmmProgram:f,cpmmAuthProgram:g}){let k=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:f!=null?f:wi,isSigner:!1,isWritable:!1},{pubkey:g!=null?g:Pi,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Me,isSigner:!1,isWritable:!1},{pubkey:En,isSigner:!1,isWritable:!1},{pubkey:Kt,isSigner:!1,isWritable:!1}],A=G([C("lpFeeAmount")]),P=Buffer.alloc(A.span);A.encode({lpFeeAmount:b},P);let w=Buffer.from([...qe.collectCpFee,...P]);return new Ve({keys:k,programId:n,data:w})}var Yi=G([se(8),j("bump"),We("disableCreatePool"),De("index"),C("tradeFeeRate"),C("protocolFeeRate"),C("fundFeeRate"),C("createPoolFee"),V("protocolOwner"),V("fundOwner"),H(C(),16)]),Ji=G([se(8),V("configId"),V("poolCreator"),V("vaultA"),V("vaultB"),V("mintLp"),V("mintA"),V("mintB"),V("mintProgramA"),V("mintProgramB"),V("observationId"),j("bump"),j("status"),j("lpDecimals"),j("mintDecimalA"),j("mintDecimalB"),C("lpAmount"),C("protocolFeesMintA"),C("protocolFeesMintB"),C("fundFeesMintA"),C("fundFeesMintB"),C("openTime"),H(C(),32)]);var Dn=class extends Qe{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){return(await this.getRpcPoolInfos([e],t))[e]}async getRpcPoolInfos(e,t){let i=await Ee(this.scope.connection,e.map(m=>({pubkey:new B(m)}))),r={},o=new Set,s=[];for(let m=0;m<e.length;m++){let d=i[m];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(e[m]));let p=Ji.decode(d.accountInfo.data);r[String(e[m])]=Z(U({},p),{programId:d.accountInfo.owner}),o.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(t){let m=[...o],d=await Ee(this.scope.connection,m.map(p=>({pubkey:new B(p)})));for(let p=0;p<m.length;p++){let b=d[p].accountInfo;if(b===null)throw Error("fetch pool config error: "+m[p]);a[m[p]]=Yi.decode(b.data)}}let c={},u=await Ee(this.scope.connection,s.map(m=>({pubkey:new B(m)})));for(let m=0;m<s.length;m++){let d=u[m].accountInfo;if(d===null)throw Error("fetch vault info error: "+s[m]);c[String(s[m])]=new J(Bs.decode(d.data).amount.toString())}let l={};for(let[m,d]of Object.entries(r)){let p=c[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),b=c[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);l[m]=Z(U({},d),{baseReserve:p,quoteReserve:b,vaultAAmount:c[d.vaultA.toString()],vaultBAmount:c[d.vaultB.toString()],configInfo:a[d.configId.toString()],poolPrice:new te(b.toString()).div(new te(10).pow(d.mintDecimalB)).div(new te(p.toString()).div(new te(10).pow(d.mintDecimalA)))})}return l}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((i,r)=>{var c,u,l,m;let o=e[r],[s,a]=[o.mintA.toBase58(),o.mintB.toBase58()];return Z(U({},i),{[r]:Z(U({},o),{id:new B(r),configInfo:o.configInfo,version:7,authority:Qt(o.programId).publicKey,mintA:_e({address:s,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(c=t[s])!=null&&c.feeConfig?Je((u=t[s])==null?void 0:u.feeConfig):void 0}}),mintB:_e({address:a,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(l=t[a])!=null&&l.feeConfig?Je((m=t[a])==null?void 0:m.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(e){let t=await this.getRpcPoolInfo(e,!0),i=await ln({connection:this.scope.connection,mints:[t.mintA,t.mintB]}),r=_e({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:i[t.mintA.toBase58()].feeConfig?Je(i[t.mintA.toBase58()].feeConfig):void 0}}),o=_e({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:i[t.mintB.toBase58()].feeConfig?Je(i[t.mintB.toBase58()].feeConfig):void 0}}),s=_e({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:ce.toBase58()}),a={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},c={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:s,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:a,mintA:r,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new te(t.vaultAAmount.toString()).div(10**r.decimals).toNumber(),mintAmountB:new te(t.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,burnPercent:0,day:c,week:c,month:c,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:r,mintB:o,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:Qt(t.programId).publicKey.toBase58(),mintLp:s,config:a,observationId:bt(t.programId,new B(e)).publicKey.toBase58()},rpcData:t}}async createPool(b){var f=b,{poolId:e,programId:t,poolFeeAccount:i,startTime:r,ownerInfo:o,associatedOnly:s=!1,checkCreateATAOwner:a=!1,txVersion:c,feeConfig:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d}=f,p=he(f,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig","txTipConfig","feePayer"]);var O,$,pe;let g=o.feePayer||((O=this.scope.owner)==null?void 0:O.publicKey),k=new J(new B(p.mintA.address).toBuffer()).lte(new J(new B(p.mintB.address).toBuffer())),[A,P]=k?[p.mintA,p.mintB]:[p.mintB,p.mintA],[w,h]=k?[p.mintAAmount,p.mintBAmount]:[p.mintBAmount,p.mintAAmount],T=o.useSOLBalance&&A.address===$t.toBase58(),I=o.useSOLBalance&&P.address===$t.toBase58(),[x,K]=[new B(A.address),new B(P.address)],S=this.createTxBuilder(d),{account:M,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:x,tokenProgram:A.programId,owner:this.scope.ownerPubKey,createInfo:T?{payer:g,amount:w}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:s,checkCreateATAOwner:a});S.addInstruction(F||{});let{account:D,instructionParams:q}=await this.scope.account.getOrCreateTokenAccount({mint:new B(P.address),tokenProgram:P.programId,owner:this.scope.ownerPubKey,createInfo:I?{payer:g,amount:h}:void 0,notUseTokenAccount:I,skipCloseAccount:!I,associatedOnly:I?!1:s,checkCreateATAOwner:a});if(S.addInstruction(q||{}),M===void 0||D===void 0)throw Error("you don't has some token account");let v=Li({poolId:e,programId:t,configId:new B(u.id),mintA:x,mintB:K});return S.addInstruction({instructions:[Xi(t,this.scope.ownerPubKey,new B(u.id),v.authority,v.poolId,x,K,v.lpMint,M,D,me(this.scope.ownerPubKey,v.lpMint).publicKey,v.vaultA,v.vaultB,i,new B(($=A.programId)!=null?$:ce),new B((pe=P.programId)!=null?pe:ce),v.observationId,w,h,r)],instructionTypes:[re.CpmmCreatePool]}),S.addCustomComputeBudget(l),S.addTipInstruction(m),S.versionBuild({txVersion:c,extInfo:{address:Z(U({},v),{mintA:A,mintB:P,programId:t,poolFeeAccount:i,feeConfig:u})}})}async addLiquidity(e){let{poolInfo:t,poolKeys:i,inputAmount:r,baseIn:o,slippage:s,computeResult:a,computeBudgetConfig:c,txTipConfig:u,config:l,txVersion:m,feePayer:d}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),r.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:r.toString()});let{account:p}=this.scope,{bypassAssociatedCheck:b,checkCreateATAOwner:f}=U({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},l),g=a?void 0:await this.getRpcPoolInfo(t.id),{liquidity:k,inputAmountFee:A,anotherAmount:P}=a||this.computePairAmount({poolInfo:Z(U({},t),{lpAmount:new te(g.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()}),baseReserve:g.baseReserve,quoteReserve:g.quoteReserve,slippage:new le(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new te(r.toString()).div(10**(o?t.mintA.decimals:t.mintB.decimals))}),w=P.amount,h=t.mintA.address===$t.toString(),T=t.mintB.address===$t.toString(),I=this.createTxBuilder(d),[x,K]=[new B(t.mintA.address),new B(t.mintB.address)],{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:h||(o?r:w).isZero()?{payer:this.scope.ownerPubKey,amount:o?r:w}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:!1,checkCreateATAOwner:f});I.addInstruction(M||{});let{account:F,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:T||(o?w:r).isZero()?{payer:this.scope.ownerPubKey,amount:o?w:r}:void 0,skipCloseAccount:!T,notUseTokenAccount:T,associatedOnly:!1,checkCreateATAOwner:f});I.addInstruction(D||{}),!S&&!F&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",p.tokenAccounts);let q=await p.getCreatedTokenAccount({mint:new B(t.lpMint.address)}),Oe=await p.handleTokenAccount({side:"out",amount:0,mint:new B(t.lpMint.address),tokenAccount:q,bypassAssociatedCheck:b,checkCreateATAOwner:f}),{tokenAccount:v}=Oe,O=he(Oe,["tokenAccount"]);I.addInstruction(O);let $=i!=null?i:await this.getCpmmPoolKeys(t.id),pe=new le(new J(1)).sub(s);return I.addInstruction({instructions:[Hi(new B(t.programId),this.scope.ownerPubKey,new B($.authority),new B(t.id),v,S,F,new B($.vault.A),new B($.vault.B),x,K,new B(t.lpMint.address),a?a==null?void 0:a.liquidity:pe.mul(k).quotient,o?A.amount:w,o?w:A.amount)],instructionTypes:[re.CpmmAddLiquidity],lookupTableAddress:$.lookupTableAccount?[$.lookupTableAccount]:[]}),I.addCustomComputeBudget(c),I.addTipInstruction(u),I.versionBuild({txVersion:m})}async withdrawLiquidity(e){var O,$;let{poolInfo:t,poolKeys:i,lpAmount:r,slippage:o,computeBudgetConfig:s,txTipConfig:a,txVersion:c,feePayer:u,closeWsol:l=!0}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let m=new le(new J(1)).sub(o),d=await this.getRpcPoolInfo(t.id),[p,b]=[m.mul(r.mul(d.baseReserve).div(d.lpAmount)).quotient,m.mul(r.mul(d.quoteReserve).div(d.lpAmount)).quotient],f=await this.scope.fetchEpochInfo(),[g,k]=[Ae(p,t.mintA.extensions.feeConfig,f,!1),Ae(b,t.mintB.extensions.feeConfig,f,!1)],{account:A}=this.scope,P=this.createTxBuilder(u),[w,h]=[new B(t.mintA.address),new B(t.mintB.address)],T=w.equals(ue),I=h.equals(ue),x,K,{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),notUseTokenAccount:T,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(T&&l),associatedOnly:!T,checkCreateATAOwner:!1});x=S,M&&P.addInstruction(M);let{account:F,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),notUseTokenAccount:I,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(I&&l),associatedOnly:!I,checkCreateATAOwner:!1});K=F,D&&P.addInstruction(D),(!x||!K)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",A.tokenAccounts);let q=await A.getCreatedTokenAccount({mint:new B(t.lpMint.address)});q||this.logAndCreateError("cannot found lp token account","tokenAccounts",A.tokenAccounts);let v=i!=null?i:await this.getCpmmPoolKeys(t.id);return P.addInstruction({instructions:[zi(new B(t.programId),this.scope.ownerPubKey,new B(v.authority),new B(t.id),q,x,K,new B(v.vault.A),new B(v.vault.B),w,h,new B(t.lpMint.address),r,p.sub((O=g.fee)!=null?O:new J(0)),b.sub(($=k.fee)!=null?$:new J(0)))],instructionTypes:[re.CpmmWithdrawLiquidity],lookupTableAddress:v.lookupTableAccount?[v.lookupTableAccount]:[]}),P.addCustomComputeBudget(s),P.addTipInstruction(a),P.versionBuild({txVersion:c})}async swap(e){var M,F,D,q,v,O;let{poolInfo:t,poolKeys:i,baseIn:r,fixedOut:o,inputAmount:s,swapResult:a,slippage:c=0,config:u,computeBudgetConfig:l,txTipConfig:m,txVersion:d,feePayer:p}=e,{bypassAssociatedCheck:b,checkCreateATAOwner:f,associatedOnly:g}=U({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},u),k=this.createTxBuilder(p),[A,P]=[new B(t.mintA.address),new B(t.mintB.address)];o?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new J((1+c)*1e4)).div(new J(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new J((1-c)*1e4)).div(new J(1e4));let w=t.mintA.address===ue.toBase58(),h=t.mintB.address===ue.toBase58(),{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:A,tokenProgram:new B((M=t.mintA.programId)!=null?M:ce),owner:this.scope.ownerPubKey,createInfo:w||!r?{payer:this.scope.ownerPubKey,amount:r?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:g,checkCreateATAOwner:f});I&&k.addInstruction(I);let{account:x,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({mint:P,tokenProgram:new B((F=t.mintB.programId)!=null?F:ce),owner:this.scope.ownerPubKey,createInfo:h||r?{payer:this.scope.ownerPubKey,amount:r?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:g,checkCreateATAOwner:f});K&&k.addInstruction(K),(!T||!x)&&this.logAndCreateError("user do not have token account",{mintA:t.mintA.symbol||t.mintA.address,mintB:t.mintB.symbol||t.mintB.address,mintATokenAcc:T,mintBTokenAcc:x,mintAUseSOLBalance:w,mintBUseSOLBalance:h,associatedOnly:g});let S=i!=null?i:await this.getCpmmPoolKeys(t.id);return k.addInstruction({instructions:[o?ji(new B(t.programId),this.scope.ownerPubKey,new B(S.authority),new B(S.config.id),new B(t.id),r?T:x,r?x:T,new B(S.vault[r?"A":"B"]),new B(S.vault[r?"B":"A"]),new B((v=t[r?"mintA":"mintB"].programId)!=null?v:ce),new B((O=t[r?"mintB":"mintA"].programId)!=null?O:ce),r?A:P,r?P:A,bt(new B(t.programId),new B(t.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):Zi(new B(t.programId),this.scope.ownerPubKey,new B(S.authority),new B(S.config.id),new B(t.id),r?T:x,r?x:T,new B(S.vault[r?"A":"B"]),new B(S.vault[r?"B":"A"]),new B((D=t[r?"mintA":"mintB"].programId)!=null?D:ce),new B((q=t[r?"mintB":"mintA"].programId)!=null?q:ce),r?A:P,r?P:A,bt(new B(t.programId),new B(t.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[o?re.CpmmSwapBaseOut:re.ClmmSwapBaseIn]}),k.addCustomComputeBudget(l),k.addTipInstruction(m),k.versionBuild({txVersion:d})}async lockLp(e){var d,p,b,f,g;let{poolInfo:t,lpAmount:i,computeBudgetConfig:r,txTipConfig:o,txVersion:s,feePayer:a,feeNftOwner:c}=e;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let u=this.createTxBuilder(a),l=(d=e.poolKeys)!=null?d:await this.getCpmmPoolKeys(t.id),m=await Qi({poolInfo:t,poolKeys:l,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(p=e.feePayer)!=null?p:this.scope.ownerPubKey},feeNftOwner:c!=null?c:this.scope.ownerPubKey,lockProgram:(b=e.programId)!=null?b:vt,lockAuthProgram:(f=e.authProgram)!=null?f:Dt,lpAmount:i,withMetadata:(g=e.withMetadata)!=null?g:!0,getEphemeralSigners:e.getEphemeralSigners});return u.addInstruction(m),u.addCustomComputeBudget(r),u.addTipInstruction(o),u.versionBuild({txVersion:s,extInfo:m.address})}async harvestLockLp(e){var F;let{poolInfo:t,lpFeeAmount:i,nftMint:r,programId:o=vt,authProgram:s=Dt,cpmmProgram:a,computeBudgetConfig:c,txTipConfig:u,txVersion:l,closeWsol:m=!0}=e;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let d=e.feePayer||this.scope.ownerPubKey,p=this.createTxBuilder(d),[b,f]=[new B(t.mintA.address),new B(t.mintB.address)],g=b.equals(ue),k=f.equals(ue),A,P,{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(g&&m),associatedOnly:!g,checkCreateATAOwner:!1});A=w,h&&p.addInstruction(h);let{account:T,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),notUseTokenAccount:k,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(k&&m),associatedOnly:!k,checkCreateATAOwner:!1});P=T,I&&p.addInstruction(I),(!A||!P)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:A,tokenAccountB:P});let x=(F=e.poolKeys)!=null?F:await this.getCpmmPoolKeys(t.id),{publicKey:K}=me(d,r,ce),{publicKey:S}=gt(o,r),{publicKey:M}=me(s,new B(t.lpMint.address),ce);return p.addInstruction({instructions:[vn({programId:o,nftOwner:this.scope.ownerPubKey,auth:s,nftMint:r,nftAccount:K,lockPda:S,poolId:new B(t.id),mintLp:new B(x.mintLp.address),userVaultA:A,userVaultB:P,poolVaultA:new B(x.vault.A),poolVaultB:new B(x.vault.B),mintA:b,mintB:f,lockLpVault:M,lpFeeAmount:i,cpmmProgram:a==null?void 0:a.programId,cpmmAuthProgram:a==null?void 0:a.authProgram})],instructionTypes:[re.CpmmCollectLockFee]}),p.addCustomComputeBudget(c),p.addTipInstruction(u),p.versionBuild({txVersion:l})}async harvestMultiLockLp(e){let{lockInfo:t,programId:i=vt,authProgram:r=Dt,cpmmProgram:o,computeBudgetConfig:s,txVersion:a,closeWsol:c=!0}=e,u=e.feePayer||this.scope.ownerPubKey,l=this.createTxBuilder(u);return t.forEach(async m=>{var K;let{poolInfo:d,lpFeeAmount:p,nftMint:b}=m;if(p.isZero())return;let[f,g]=[new B(d.mintA.address),new B(d.mintB.address)],k=f.equals(ue),A=g.equals(ue),P,w;if(k){let{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new B(d.mintA.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!c,associatedOnly:!1,checkCreateATAOwner:!1});P=S,M&&l.addInstruction(M)}else{let S=new B(d.mintA.address);P=this.scope.account.getAssociatedTokenAccount(S,new B(d.mintA.programId)),l.addInstruction({instructions:[$i(this.scope.ownerPubKey,P,this.scope.ownerPubKey,S)]})}if(A){let{account:S,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new B(d.mintB.address),notUseTokenAccount:!0,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!c,associatedOnly:!1,checkCreateATAOwner:!1});w=S,M&&l.addInstruction(M)}else{let S=new B(d.mintB.address);w=this.scope.account.getAssociatedTokenAccount(S,new B(d.mintB.programId)),l.addInstruction({instructions:[$i(this.scope.ownerPubKey,w,this.scope.ownerPubKey,S)]})}(!P||!w)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:P,tokenAccountB:w});let h=(K=m.poolKeys)!=null?K:await this.getCpmmPoolKeys(d.id),{publicKey:T}=me(u,b,ce),{publicKey:I}=gt(i,b),{publicKey:x}=me(r,new B(d.lpMint.address),ce);l.addInstruction({instructions:[vn({programId:i,nftOwner:this.scope.ownerPubKey,auth:r,nftMint:b,nftAccount:T,lockPda:I,poolId:new B(d.id),mintLp:new B(h.mintLp.address),userVaultA:P,userVaultB:w,poolVaultA:new B(h.vault.A),poolVaultB:new B(h.vault.B),mintA:f,mintB:g,lockLpVault:x,lpFeeAmount:p,cpmmProgram:o==null?void 0:o.programId,cpmmAuthProgram:o==null?void 0:o.authProgram})],instructionTypes:[re.CpmmCollectLockFee]})}),a===0?l.sizeCheckBuildV0({computeBudgetConfig:s}):l.sizeCheckBuild({computeBudgetConfig:s})}computeSwapAmount({pool:e,amountIn:t,outputMint:i,slippage:r}){let o=i.toString()===e.mintB.address,s=Zt.swap(t,o?e.baseReserve:e.quoteReserve,o?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate),a=new te(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),c=s.destinationAmountSwapped.mul(new J((1-r)*1e4)).div(new J(1e4));return{allTrade:s.sourceAmountSwapped.eq(t),amountIn:t,amountOut:s.destinationAmountSwapped,minAmountOut:c,executionPrice:a,fee:s.tradeFee,priceImpact:e.poolPrice.sub(a).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:i,amount:r,slippage:o,epochInfo:s,baseIn:a}){var w,h,T,I,x,K,S,M,F;let c=1-Number(o.toSignificant())/100,u=new J(new te(r).mul(10**e[a?"mintA":"mintB"].decimals).mul(c).toFixed(0)),l=Ae(u,e[a?"mintA":"mintB"].extensions.feeConfig,s,!1),m=u.sub((w=l.fee)!=null?w:new J(0)),d=new J(new te(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,te.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",a?e.mintA.symbol:e.mintB.symbol,"amountIn:",u.toString(),"amountInFee:",(T=(h=l.fee)==null?void 0:h.toString())!=null?T:0,"anotherToken:",a?e.mintB.symbol:e.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let b=m.mul(d).div(p==="base"?t:i),f={amount:Pn,fee:void 0,expirationTime:void 0};if(!m.isZero()){let D=Is(b,t,i,d);this.logDebug("lpAmountData:",{amountA:D.amountA.toString(),amountB:D.amountB.toString()}),f=Ae(D[a?"amountB":"amountA"],e[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let g=new le(new J(1)).add(o),k=new le(new J(1)).sub(o),A=Ae(g.mul(f.amount.sub((I=f.fee)!=null?I:new J(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0),P=Ae(k.mul(f.amount.sub((x=f.fee)!=null?x:new J(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(S=(K=f.fee)==null?void 0:K.toString())!=null?S:0,"maxAnotherAmount:",A.amount.toString(),"maxAnotherAmountFee:",(F=(M=A.fee)==null?void 0:M.toString())!=null?F:0),{inputAmountFee:l,anotherAmount:f,maxAnotherAmount:A,minAnotherAmount:P,liquidity:b}}};function Is(n,e,t,i){let r=n.mul(e).div(i);!r.isZero()&&!n.mul(e).mod(i).isZero()&&(r=r.add(new J(1)));let o=n.mul(t).div(i);return!o.isZero()&&!n.mul(t).mod(i).isZero()&&(o=o.add(new J(1))),{amountA:r,amountB:o}}export{Dn as default};
//# sourceMappingURL=cpmm.mjs.map