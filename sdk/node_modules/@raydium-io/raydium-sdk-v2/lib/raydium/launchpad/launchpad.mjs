var dr=Object.defineProperty,pr=Object.defineProperties;var fr=Object.getOwnPropertyDescriptors;var It=Object.getOwnPropertySymbols;var Jn=Object.prototype.hasOwnProperty,$n=Object.prototype.propertyIsEnumerable;var Yn=(n,e,t)=>e in n?dr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,G=(n,e)=>{for(var t in e||(e={}))Jn.call(e,t)&&Yn(n,t,e[t]);if(It)for(var t of It(e))$n.call(e,t)&&Yn(n,t,e[t]);return n},Q=(n,e)=>pr(n,fr(e));var Ve=(n,e)=>{var t={};for(var i in n)Jn.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&It)for(var i of It(n))e.indexOf(i)<0&&$n.call(n,i)&&(t[i]=n[i]);return t};import{get as ei,set as br}from"lodash";var on=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ti={},yr={};function re(n){let e=ei(ti,n);if(!e){let t=ei(yr,n);e=new on({name:n,logLevel:t}),br(ti,n,e)}return e}import{PublicKey as Je,sendAndConfirmTransaction as Bn,SystemProgram as zo,Transaction as yt,TransactionMessage as gt,VersionedTransaction as Pt}from"@solana/web3.js";import Zo from"axios";import{PublicKey as Ki,AddressLookupTableAccount as Ut}from"@solana/web3.js";import{PublicKey as Ho}from"@solana/web3.js";import Te from"bn.js";var Ze=9e15,ve=1e9,sn="0123456789abcdef",Ct="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Kt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",an={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ze,maxE:Ze,crypto:!1},oi,Se,O=!0,Lt="[DecimalError] ",Me=Lt+"Invalid argument: ",si=Lt+"Precision limit exceeded",ai=Lt+"crypto unavailable",ui="[object Decimal]",oe=Math.floor,te=Math.pow,gr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Pr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ar=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ci=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ye=1e7,M=7,wr=9007199254740991,kr=Ct.length-1,un=Kt.length-1,y={toStringTag:ui};y.absoluteValue=y.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),L(n)};y.ceil=function(){return L(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Me+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};y.comparedTo=y.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};y.cosine=y.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+M,i.rounding=1,t=hr(i,fi(i,t)),i.precision=n,i.rounding=e,L(Se==2||Se==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};y.cubeRoot=y.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(O=!1,o=l.s*te(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ne(l.d),n=l.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=te(t,1/3),n=oe((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new m(t),i.s=l.s):i=new m(o.toString()),s=(n=m.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(l),i=j(u.plus(l).times(a),u.plus(c),s+2,1),ne(a.d).slice(0,s)===(t=ne(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(L(a,n+1,0),a.times(a).times(a).eq(l))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(L(i,n+1,1),e=!i.times(i).times(i).eq(l));break}return O=!0,L(i,n,m.rounding,e)};y.decimalPlaces=y.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-oe(this.e/M))*M,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};y.dividedBy=y.div=function(n){return j(this,new this.constructor(n))};y.dividedToIntegerBy=y.divToInt=function(n){var e=this,t=e.constructor;return L(j(e,new t(n),0,1,1),t.precision,t.rounding)};y.equals=y.eq=function(n){return this.cmp(n)===0};y.floor=function(){return L(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(n){return this.cmp(n)>0};y.greaterThanOrEqualTo=y.gte=function(n){var e=this.cmp(n);return e==1||e===0};y.hyperbolicCosine=y.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/Mt(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=je(s,1,o.times(e),new s(1),!0);for(var c,u=n,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return L(o,s.precision=t,s.rounding=i,!0)};y.hyperbolicSine=y.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=je(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/Mt(5,n)),r=je(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,L(r,e,t,!0)};y.hyperbolicTangent=y.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,j(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};y.inverseCosine=y.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?be(t,r,o):new t(0):new t(NaN):e.isZero()?be(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=be(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};y.inverseHyperbolicCosine=y.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,O=!1,t=t.times(t).minus(1).sqrt().plus(t),O=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};y.inverseHyperbolicSine=y.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,O=!1,t=t.times(t).plus(1).sqrt().plus(t),O=!0,i.precision=n,i.rounding=e,t.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?L(new o(r),n,e,!0):(o.precision=t=i-r.e,r=j(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};y.inverseSine=y.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=be(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};y.inverseTangent=y.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=un)return s=be(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=un)return s=be(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/M+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(O=!1,e=Math.ceil(a/M),i=1,c=u.times(u),s=new l(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),O=!0,L(s,l.precision=m,l.rounding=d,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&oe(this.e/M)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(n){return this.cmp(n)<0};y.lessThanOrEqualTo=y.lte=function(n){return this.cmp(n)<1};y.logarithm=y.log=function(n){var e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(n==null)n=new l(10),e=!0;else{if(n=new l(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new l(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(O=!1,a=m+p,s=Re(u,a),i=e?Nt(l,a+10):Re(n,a),c=j(s,i,a,1),at(c.d,r=m,d))do if(a+=10,s=Re(u,a),i=e?Nt(l,a+10):Re(n,a),c=j(s,i,a,1),!o){+ne(c.d).slice(r+1,r+15)+1==1e14&&(c=L(c,m+1,0));break}while(at(c.d,r+=10,d));return O=!0,L(c,m,d)};y.minus=y.sub=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.constructor;if(n=new f(n),!p.d||!n.d)return!p.s||!n.s?n=new f(NaN):p.d?n.s=-n.s:n=new f(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=f.precision,c=f.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new f(p);else return new f(c===3?-0:0);return O?L(n,a,c):n}if(t=oe(n.e/M),l=oe(p.e/M),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),i=Math.max(Math.ceil(a/M),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,m=i<s,m&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){m=u[i]<d[i];break}o=0}for(m&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=ye-1;--u[r],u[i]+=ye}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=Rt(u,t),O?L(n,a,c):n):new f(c===3?-0:0)};y.modulo=y.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?L(new i(t),i.precision,i.rounding):(O=!1,i.modulo==9?(e=j(t,n.abs(),0,3,1),e.s*=n.s):e=j(t,n,0,i.modulo,1),e=e.times(n),O=!0,t.minus(e))};y.naturalExponential=y.exp=function(){return cn(this)};y.naturalLogarithm=y.ln=function(){return Re(this)};y.negated=y.neg=function(){var n=new this.constructor(this);return n.s=-n.s,L(n)};y.plus=y.add=function(n){var e,t,i,r,o,s,a,c,u,l,m=this,d=m.constructor;if(n=new d(n),!m.d||!n.d)return!m.s||!n.s?n=new d(NaN):m.d||(n=new d(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(u=m.d,l=n.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(n=new d(m)),O?L(n,a,c):n;if(o=oe(m.e/M),i=oe(n.e/M),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,i=o,s=u.length),o=Math.ceil(a/M),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/ye|0,u[r]%=ye;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=Rt(u,i),O?L(n,a,c):n};y.precision=y.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Me+n);return t.d?(e=li(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};y.round=function(){var n=this,e=n.constructor;return L(new e(n),n.e+1,e.rounding)};y.sine=y.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+M,i.rounding=1,t=Br(i,fi(i,t)),i.precision=n,i.rounding=e,L(Se>2?t.neg():t,n,e,!0)):new i(NaN)};y.squareRoot=y.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(O=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ne(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=oe((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new l(e)):i=new l(u.toString()),t=(c=l.precision)+3;;)if(o=i,i=o.plus(j(s,o,t+2,1)).times(.5),ne(o.d).slice(0,t)===(e=ne(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(L(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(L(i,c+1,1),n=!i.times(i).eq(s));break}return O=!0,L(i,c,l.rounding,n)};y.tangent=y.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=j(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,L(Se==2||Se==4?t.neg():t,n,e,!0)):new i(NaN)};y.times=y.mul=function(n){var e,t,i,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=oe(l.e/M)+oe(n.e/M),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%ye|0,e=a/ye|0;o[r]=(o[r]+e)%ye|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=Rt(o,t),O?L(n,m.precision,m.rounding):n};y.toBinary=function(n,e){return mn(this,2,n,e)};y.toDecimalPlaces=y.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(le(n,0,ve),e===void 0?e=i.rounding:le(e,0,8),L(t,n+t.e+1,e))};y.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ke(i,!0):(le(n,0,ve),e===void 0?e=r.rounding:le(e,0,8),i=L(new r(i),n+1,e),t=ke(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=ke(r):(le(n,0,ve),e===void 0?e=o.rounding:le(e,0,8),i=L(new o(r),n+r.e+1,e),t=ke(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};y.toFraction=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.d,b=p.constructor;if(!f)return new b(p);if(u=t=new b(1),i=c=new b(0),e=new b(i),o=e.e=li(f)-p.e-1,s=o%M,e.d[0]=te(10,s<0?M+s:s),n==null)n=o>0?e:u;else{if(a=new b(n),!a.isInt()||a.lt(u))throw Error(Me+a);n=a.gt(e)?o>0?e:u:a}for(O=!1,a=new b(ne(f)),l=b.precision,b.precision=o=f.length*M*2;m=j(a,e,0,1,1),r=t.plus(m.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=j(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=j(u,i,o,1).minus(p).abs().cmp(j(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],b.precision=l,O=!0,d};y.toHexadecimal=y.toHex=function(n,e){return mn(this,16,n,e)};y.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:le(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(O=!1,t=j(t,n,0,e,1).times(n),O=!0,L(t)):(n.s=t.s,t=n),t};y.toNumber=function(){return+this};y.toOctal=function(n,e){return mn(this,8,n,e)};y.toPower=y.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(te(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return L(a,i,o);if(e=oe(n.e/M),e>=n.d.length-1&&(t=u<0?-u:u)<=wr)return r=mi(c,a,t,i),n.s<0?new c(1).div(r):L(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=te(+a,u),e=t==0||!isFinite(t)?oe(u*(Math.log("0."+ne(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(O=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=cn(n.times(Re(a,i+t)),i),r.d&&(r=L(r,i+5,1),at(r.d,i,o)&&(e=i+10,r=L(cn(n.times(Re(a,e+t)),e),e+5,1),+ne(r.d).slice(i+1,i+15)+1==1e14&&(r=L(r,i+1,0)))),r.s=s,O=!0,c.rounding=o,L(r,i,o))};y.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ke(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(le(n,1,ve),e===void 0?e=r.rounding:le(e,0,8),i=L(new r(i),n,e),t=ke(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toSignificantDigits=y.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(le(n,1,ve),e===void 0?e=i.rounding:le(e,0,8)),L(new i(t),n,e)};y.toString=function(){var n=this,e=n.constructor,t=ke(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};y.truncated=y.trunc=function(){return L(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var n=this,e=n.constructor,t=ke(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function ne(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=M-i.length,t&&(o+=Le(t)),o+=i;s=n[e],i=s+"",t=M-i.length,t&&(o+=Le(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function le(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Me+n)}function at(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=M,r=0):(r=Math.ceil((e+1)/M),e%=M),o=te(10,M-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==te(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==te(10,e-3)-1,s}function St(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=sn.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function hr(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/Mt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=je(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var j=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,l,m,d,p,f,b,g,h,w,A,k,x,I,S,T,W,_,E,B,N=i.constructor,H=i.s==r.s?1:-1,F=i.d,R=r.d;if(!F||!F[0]||!R||!R[0])return new N(!i.s||!r.s||(F?R&&F[0]==R[0]:!R)?NaN:F&&F[0]==0||!R?H*0:H/0);for(c?(p=1,l=i.e-r.e):(c=ye,p=M,l=oe(i.e/p)-oe(r.e/p)),E=R.length,W=F.length,h=new N(H),w=h.d=[],m=0;R[m]==(F[m]||0);m++);if(R[m]>(F[m]||0)&&l--,o==null?(I=o=N.precision,s=N.rounding):a?I=o+(i.e-r.e)+1:I=o,I<0)w.push(1),f=!0;else{if(I=I/p+2|0,m=0,E==1){for(d=0,R=R[0],I++;(m<W||d)&&I--;m++)S=d*c+(F[m]||0),w[m]=S/R|0,d=S%R|0;f=d||m<W}else{for(d=c/(R[0]+1)|0,d>1&&(R=n(R,d,c),F=n(F,d,c),E=R.length,W=F.length),T=E,A=F.slice(0,E),k=A.length;k<E;)A[k++]=0;B=R.slice(),B.unshift(0),_=R[0],R[1]>=c/2&&++_;do d=0,u=e(R,A,E,k),u<0?(x=A[0],E!=k&&(x=x*c+(A[1]||0)),d=x/_|0,d>1?(d>=c&&(d=c-1),b=n(R,d,c),g=b.length,k=A.length,u=e(b,A,g,k),u==1&&(d--,t(b,E<g?B:R,g,c))):(d==0&&(u=d=1),b=R.slice()),g=b.length,g<k&&b.unshift(0),t(A,b,k,c),u==-1&&(k=A.length,u=e(R,A,E,k),u<1&&(d++,t(A,E<k?B:R,k,c))),k=A.length):u===0&&(d++,A=[0]),w[m++]=d,u&&A[0]?A[k++]=F[T]||0:(A=[F[T]],k=1);while((T++<W||A[0]!==void 0)&&I--);f=A[0]!==void 0}w[0]||w.shift()}if(p==1)h.e=l,oi=f;else{for(m=1,d=w[0];d>=10;d/=10)m++;h.e=m+l*p-1,L(h,a?o+h.e+1:o,s,f)}return h}}();function L(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor;e:if(e!=null){if(m=n.d,!m)return n;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=M,s=e,l=m[d=0],c=l/te(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/M),a=m.length,d>=a)if(i){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=M,s=o-M+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=M,s=o-M+r,c=s<0?0:l/te(10,r-s-1)%10|0}if(i=i||e<0||m[d+1]!==void 0||(s<0?l:l%te(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?l/te(10,r-s):0:m[d-1])%10&1||t==(n.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=n.e+1,m[0]=te(10,(M-e%M)%M),n.e=-e||0):m[0]=n.e=0,n;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=te(10,M-o),m[d]=s>0?(l/te(10,r-s)%te(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==ye&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=ye)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return O&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function ke(n,e,t){if(!n.isFinite())return pi(n);var i,r=n.e,o=ne(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Le(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Le(-r-1)+o,t&&(i=t-s)>0&&(o+=Le(i))):r>=s?(o+=Le(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Le(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Le(i))),o}function Rt(n,e){var t=n[0];for(e*=M;t>=10;t/=10)e++;return e}function Nt(n,e,t){if(e>kr)throw O=!0,t&&(n.precision=t),Error(si);return L(new n(Ct),e,1,!0)}function be(n,e,t){if(e>un)throw Error(si);return L(new n(Kt),e,t,!0)}function li(n){var e=n.length-1,t=e*M+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Le(n){for(var e="";n--;)e+="0";return e}function mi(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/M+4);for(O=!1;;){if(t%2&&(o=o.times(e),ii(o.d,s)&&(r=!0)),t=oe(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ii(e.d,s)}return O=!0,o}function ni(n){return n.d[n.d.length-1]&1}function di(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function cn(n,e){var t,i,r,o,s,a,c,u=0,l=0,m=0,d=n.constructor,p=d.rounding,f=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(O=!1,c=f):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),m+=5;for(i=Math.log(te(2,m))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=L(o.times(n),c,1),t=t.times(++l),a=s.plus(j(o,t,c,1)),ne(a.d).slice(0,c)===ne(s.d).slice(0,c)){for(r=m;r--;)s=L(s.times(s),c,1);if(e==null)if(u<3&&at(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return L(s,d.precision=f,p,O=!0);else return d.precision=f,s}s=a}}function Re(n,e){var t,i,r,o,s,a,c,u,l,m,d,p=1,f=10,b=n,g=b.d,h=b.constructor,w=h.rounding,A=h.precision;if(b.s<0||!g||!g[0]||!b.e&&g[0]==1&&g.length==1)return new h(g&&!g[0]?-1/0:b.s!=1?NaN:g?0:b);if(e==null?(O=!1,l=A):l=e,h.precision=l+=f,t=ne(g),i=t.charAt(0),Math.abs(o=b.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)b=b.times(n),t=ne(b.d),i=t.charAt(0),p++;o=b.e,i>1?(b=new h("0."+t),o++):b=new h(i+"."+t.slice(1))}else return u=Nt(h,l+2,A).times(o+""),b=Re(new h(i+"."+t.slice(1)),l-f).plus(u),h.precision=A,e==null?L(b,A,w,O=!0):b;for(m=b,c=s=b=j(b.minus(1),b.plus(1),l,1),d=L(b.times(b),l,1),r=3;;){if(s=L(s.times(d),l,1),u=c.plus(j(s,new h(r),l,1)),ne(u.d).slice(0,l)===ne(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Nt(h,l+2,A).times(o+""))),c=j(c,new h(p),l,1),e==null)if(at(c.d,l-f,w,a))h.precision=l+=f,u=s=b=j(m.minus(1),m.plus(1),l,1),d=L(b.times(b),l,1),r=a=1;else return L(c,h.precision=A,w,O=!0);else return h.precision=A,c;c=u,r+=2}}function pi(n){return String(n.s*n.s/0)}function ln(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%M,t<0&&(i+=M),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=M;i<r;)n.d.push(+e.slice(i,i+=M));e=e.slice(i),i=M-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),O&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function Tr(n,e){var t,i,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ci.test(e))return ln(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(Pr.test(e))t=16,e=e.toLowerCase();else if(gr.test(e))t=2;else if(Ar.test(e))t=8;else throw Error(Me+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=mi(i,new i(t),o,o*2)),u=St(e,t,ye),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=Rt(u,l),n.d=u,O=!1,s&&(n=j(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?te(2,c):ut.pow(2,c))),O=!0,n)}function Br(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:je(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/Mt(5,t)),e=je(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function je(n,e,t,i,r){var o,s,a,c,u=1,l=n.precision,m=Math.ceil(l/M);for(O=!1,c=t.times(t),a=new n(i);;){if(s=j(a.times(c),new n(e++*e++),l,1),a=r?i.plus(s):i.minus(s),i=j(s.times(c),new n(e++*e++),l,1),s=a.plus(i),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return O=!0,s.d.length=m+1,s}function Mt(n,e){for(var t=n;--e;)t*=n;return t}function fi(n,e){var t,i=e.s<0,r=be(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Se=i?4:1,e;if(t=e.divToInt(r),t.isZero())Se=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Se=ni(t)?i?2:3:i?4:1,e;Se=ni(t)?i?1:4:i?3:2}return e.minus(r).abs()}function mn(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor,f=t!==void 0;if(f?(le(t,1,ve),i===void 0?i=p.rounding:le(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())l=pi(n);else{for(l=ke(n),s=l.indexOf("."),f?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=St(ke(d),10,r),d.e=d.d.length),m=St(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=f?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=j(n,d,t,i,0,r),m=n.d,o=n.e,u=oi),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&m[t-1]&1||i===(n.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=sn.charAt(m[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=St(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=sn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return n.s<0?"-"+l:l}function ii(n,e){if(n.length>e)return n.length=e,!0}function xr(n){return new this(n).abs()}function Ir(n){return new this(n).acos()}function Sr(n){return new this(n).acosh()}function Cr(n,e){return new this(n).plus(e)}function Kr(n){return new this(n).asin()}function Nr(n){return new this(n).asinh()}function Lr(n){return new this(n).atan()}function Rr(n){return new this(n).atanh()}function Mr(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=be(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?be(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=be(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(j(n,e,o,1)),e=be(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(j(n,e,o,1)),t}function vr(n){return new this(n).cbrt()}function Fr(n){return L(n=new this(n),n.e+1,2)}function Er(n,e,t){return new this(n).clamp(e,t)}function Or(n){if(!n||typeof n!="object")throw Error(Lt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,ve,"rounding",0,8,"toExpNeg",-Ze,0,"toExpPos",0,Ze,"maxE",0,Ze,"minE",-Ze,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=an[t]),(i=n[t])!==void 0)if(oe(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Me+t+": "+i);if(t="crypto",r&&(this[t]=an[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ai);else this[t]=!1;else throw Error(Me+t+": "+i);return this}function Dr(n){return new this(n).cos()}function Wr(n){return new this(n).cosh()}function bi(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ri(o)){u.s=o.s,O?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;O?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return ln(u,o.toString())}else if(c!=="string")throw Error(Me+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),ci.test(o)?ln(u,o):Tr(u,o)}if(r.prototype=y,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Or,r.clone=bi,r.isDecimal=ri,r.abs=xr,r.acos=Ir,r.acosh=Sr,r.add=Cr,r.asin=Kr,r.asinh=Nr,r.atan=Lr,r.atanh=Rr,r.atan2=Mr,r.cbrt=vr,r.ceil=Fr,r.clamp=Er,r.cos=Dr,r.cosh=Wr,r.div=_r,r.exp=Vr,r.floor=qr,r.hypot=Ur,r.ln=Gr,r.log=Xr,r.log10=zr,r.log2=Hr,r.max=Zr,r.min=jr,r.mod=Qr,r.mul=Yr,r.pow=Jr,r.random=$r,r.round=eo,r.sign=to,r.sin=no,r.sinh=io,r.sqrt=ro,r.sub=oo,r.sum=so,r.tan=ao,r.tanh=uo,r.trunc=co,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function _r(n,e){return new this(n).div(e)}function Vr(n){return new this(n).exp()}function qr(n){return L(n=new this(n),n.e+1,3)}function Ur(){var n,e,t=new this(0);for(O=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return O=!0,new this(1/0);t=e}return O=!0,t.sqrt()}function ri(n){return n instanceof ut||n&&n.toStringTag===ui||!1}function Gr(n){return new this(n).ln()}function Xr(n,e){return new this(n).log(e)}function Hr(n){return new this(n).log(2)}function zr(n){return new this(n).log(10)}function Zr(){return di(this,arguments,"lt")}function jr(){return di(this,arguments,"gt")}function Qr(n,e){return new this(n).mod(e)}function Yr(n,e){return new this(n).mul(e)}function Jr(n,e){return new this(n).pow(e)}function $r(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:le(n,1,ve),i=Math.ceil(n/M),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(ai);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=M,i&&n&&(r=te(10,M-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=M)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<M&&(t-=M-i)}return s.e=t,s.d=a,s}function eo(n){return L(n=new this(n),n.e+1,this.rounding)}function to(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function no(n){return new this(n).sin()}function io(n){return new this(n).sinh()}function ro(n){return new this(n).sqrt()}function oo(n,e){return new this(n).sub(e)}function so(){var n=0,e=arguments,t=new this(e[n]);for(O=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return O=!0,L(t,this.precision,this.rounding)}function ao(n){return new this(n).tan()}function uo(n){return new this(n).tanh()}function co(n){return L(n=new this(n),n.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var ut=y.constructor=bi(an);Ct=new ut(Ct);Kt=new ut(Kt);var V=ut;import Po from"big.js";import Ys from"bn.js";import lo from"toformat";var mo=lo,ct=mo;import Ft from"big.js";import fo from"bn.js";import bo from"decimal.js-light";import lt from"bn.js";var yi=9007199254740991;function he(n){let e=re("Raydium_parseBigNumberish");if(n instanceof lt)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new lt(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=yi||n<=-yi)&&e.logWithError(`BigNumberish number overflow: ${n}`),new lt(String(n))):typeof n=="bigint"?new lt(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new lt(0))}var vt=re("module/fraction"),dn=ct(Ft),mt=ct(bo),yo={[0]:mt.ROUND_DOWN,[1]:mt.ROUND_HALF_UP,[2]:mt.ROUND_UP},go={[0]:Ft.roundDown,[1]:Ft.roundHalfUp,[2]:Ft.roundUp},Y=class{constructor(e,t=new fo(1)){this.numerator=he(e),this.denominator=he(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Y(this.denominator,this.numerator)}add(e){let t=e instanceof Y?e:new Y(he(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.add(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Y?e:new Y(he(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.sub(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Y?e:new Y(he(e));return new Y(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Y?e:new Y(he(e));return new Y(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<=0&&vt.logWithError(`${e} is not positive.`),mt.set({precision:e+1,rounding:yo[i]});let r=new mt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||vt.logWithError(`${e} is not an integer.`),e<0&&vt.logWithError(`${e} is negative.`),dn.DP=e,dn.RM=go[i]||1,new dn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var sa=re("Raydium_amount"),aa=ct(Po);import{PublicKey as wo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as gi}from"@solana/spl-token";var pn={chainId:101,address:wo.default.toBase58(),programId:gi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Fe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:gi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as yn}from"@solana/web3.js";import{PublicKey as J,SystemProgram as Pi,SYSVAR_RENT_PUBKEY as ko}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ho}from"@solana/spl-token";function fn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var ba=[fn({pubkey:ho,isWritable:!1}),fn({pubkey:Pi.programId,isWritable:!1}),fn({pubkey:ko,isWritable:!1})];function Ai({publicKey:n,transformSol:e}){let t=wi(n.toString());if(t instanceof J)return e&&t.equals(dt)?Et:t;if(e&&t.toString()===dt.toBase58())return Et;if(typeof t=="string"){if(t===J.default.toBase58())return J.default;try{return new J(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function wi(n){try{return new J(n)}catch{return n}}var To=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Bo=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),bn=new J("SysvarRent111111111111111111111111111111111"),ya=new J("SysvarC1ock11111111111111111111111111111111"),Qe=new J("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ga=new J("Sysvar1nstructions1111111111111111111111111"),Pa=Pi.programId,Aa=new J("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),wa=new J("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ka=new J("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ha=new J("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ta=new J("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ba=new J("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),xa=new J("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ia=new J("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Sa=new J("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ca=new J("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ka=new J("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Et=new J("So11111111111111111111111111111111111111112"),dt=J.default;var gn=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===dt.toBase58()||e instanceof yn&&dt.equals(e)){this.decimals=Fe.decimals,this.symbol=Fe.symbol,this.name=Fe.name,this.mint=new yn(Fe.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?yn.default:Ai({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ee=gn;Ee.WSOL=new gn(Q(G({},Fe),{mint:Fe.address}));var Pn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},Ot=Pn;Ot.SOL=new Pn(pn);import xo from"bn.js";var Va=new Y(new xo(100));var za=re("Raydium_price");import{PublicKey as lu}from"@solana/web3.js";import du from"bn.js";var Io=new Te(0),Nu=new Te(1),Lu=new Te(2),Ru=new Te(3),Mu=new Te(5),Ao=new Te(10),vu=new Te(100),Fu=new Te(1e3),Eu=new Te(1e4);function ki(n,e,t){return n.mul(e).add(t).sub(new Te(1)).div(t)}function kn(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as Mo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vo}from"@solana/spl-token";import{ComputeBudgetProgram as hi,Keypair as Bi,PublicKey as So,Transaction as xi,TransactionMessage as Co,VersionedTransaction as Ii}from"@solana/web3.js";var qe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Ko}from"@solana/spl-token";var Ti=re("Raydium_txUtil"),Si=1644;function Wt(n){let e=[],t=[];return n.microLamports&&(e.push(hi.setComputeUnitPrice({microLamports:n.microLamports})),t.push(qe.SetComputeUnitPrice)),n.units&&(e.push(hi.setComputeUnitLimit({units:n.units})),t.push(qe.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ye(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function _t(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(Object.assign(o.err,{txId:e}))},"confirmed")})}function No(n,e){n.length<1&&Ti.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Ti.logWithError(`no signers provided:, ${e.toString()}`);let t=new xi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Si}catch{return!1}}function ge(n,e){let[t,i]=So.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function pt({instructions:n,payer:e,signers:t}){return No(n,[e,...t])}function ft({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=Bi.generate().publicKey.toString()}){let o=new Co({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ii(o).serialize()).toString("base64").length<Si}catch{return!1}}var Lo=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Ro=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Ii&&(e=Lo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Ue(n){let e=[];return n.forEach(t=>{t instanceof xi&&(t.recentBlockhash||(t.recentBlockhash=Ko.toBase58()),t.feePayer||(t.feePayer=Bi.generate().publicKey)),e.push(Ro(t))}),console.log("simulate tx string:",e),e}function Ce(n,e,t){return ge([n.toBuffer(),(t!=null?t:vo).toBuffer(),e.toBuffer()],new Mo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as D}from"@solana/web3.js";var ic=new D("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),rc=new D("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),oc=new D("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),sc=new D("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ac=new D("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),uc=new D("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),cc=new D("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),lc=new D("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),mc=new D("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),dc=new D("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Fo=new D("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Eo=new D("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Oo=new D("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),pc=new D("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),fc=new D("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),bc=new D("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),yc=new D("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),gc=new D("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Pc=new D("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ac=new D("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),wc=new D("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),kc=new D("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Do=new D("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Wo=new D("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),_o=new D("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),hc=new D("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Vo=new D("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Tc=new D("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),qo=new D("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),pe=new D("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Bc=new D("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Uo=new D("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Go=new D("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var xc={AMM_V4:new D("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AMM_STABLE:new D("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM_PROGRAM_ID:new D("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new D("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new D("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),FARM_PROGRAM_ID_V3:new D("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FARM_PROGRAM_ID_V5:new D("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FARM_PROGRAM_ID_V6:new D("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),OPEN_BOOK_PROGRAM:new D("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:D.default,UTIL1216:D.default,Router:new D("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Do,CREATE_CPMM_POOL_AUTH:Wo,CREATE_CPMM_POOL_FEE_ACC:_o,LOCK_CPMM_PROGRAM:Vo,LOCK_CPMM_AUTH:qo,LAUNCHPAD_PROGRAM:Uo,LAUNCHPAD_AUTH:Go,FEE_DESTINATION_ID:new D("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Vt from"bn.js";function qt(n,e){if(n.isZero())return new Vt(0);let t=n.div(e);return t.isZero()?new Vt(1):n.mod(e).gt(new Vt(0))?t.add(new Vt(1)):t}import Xo from"bn.js";var Ge=new Xo(1e6);import{MINT_SIZE as il,TOKEN_PROGRAM_ID as rl,getTransferFeeConfig as ol,unpackMint as sl}from"@solana/spl-token";var hn=re("Raydium_accountInfo_util");async function bt(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=G({batchRequest:!1},t),s=kn(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=kn(c,10);a=(await(await Promise.all(u.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&hn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:f,lamports:b,owner:g,rentEpoch:h}=d;return p.length!==2&&p[1]!=="base64"&&hn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:f,lamports:b,owner:new Ho(g),rentEpoch:h}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&hn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Xe(n,e,t){let i=await bt(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>Q(G({},r),{accountInfo:i[o]}))}async function Tn({connection:n,address:e}){let t=await bt(n,[...new Set(e.map(r=>r.toString()))].map(r=>new Ki(r))),i={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Ut({key:s,state:Ut.deserialize(o.data)});i[s.toString()]=a,Gt[s.toString()]=a}return i}var Gt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Ut({key:new Ki("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Ut.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};var Xt=2e3,Ht=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Zo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Wt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(zo.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Je(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(qe.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Je.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(G({},t||{})):this.build(t)}build(e){var i;let t=new yt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o!=null?o:await Ye(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Ue([t]),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await Bn(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let d of m)try{d.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var h;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:f,skipPreflight:b=!0}=l||{},g=f!=null?f:await Ye(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(m){let w=[],A=0;for(let k of s){if(++A,A<=p)continue;let x=await Bn(this.connection,k,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});w.push(x)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=g,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:b})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((k,x)=>(k.recentBlockhash=g,a[x].length&&k.sign(...a[x]),k));Ue(w);let A=await this.signAllTransactions(w);if(m){let k=0,x=[],I=async()=>{if(!A[k])return;let S=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:b});x.push({txId:S,status:"sent",signedTx:A[k]}),d==null||d([...x]),k++;let T=!1,W=null,_=null,E=B=>{W!==null&&clearInterval(W),_!==null&&this.connection.removeSignatureListener(_);let N=x.findIndex(H=>H.txId===S);if(N>-1){if(x[N].status==="error"||x[N].status==="success")return;x[N].status=B.err?"error":"success"}d==null||d([...x]),B.err||I()};this.loopMultiTxStatus&&(W=setInterval(async()=>{var B;if(T){clearInterval(W);return}try{let N=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(T=!0,clearInterval(W),E({err:((B=N.meta)==null?void 0:B.err)||null}),console.log("tx status from getTransaction:",S))}catch(N){T=!0,clearInterval(W),console.error("getTransaction timeout:",N,S)}},Xt)),_=this.connection.onSignature(S,B=>{if(T){this.connection.removeSignatureListener(_);return}T=!0,E(B)},"confirmed"),this.connection.getSignatureStatus(S)};return await I(),{txIds:x.map(S=>S.txId),signedTxs:A}}else{let k=[];for(let x=0;x<A.length;x+=1){let I=await this.connection.sendRawTransaction(A[x].serialize(),{skipPreflight:b});k.push(I)}return{txIds:k,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var b;let f=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=f,s=Ve(f,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=G(G({},this.cluster==="devnet"?{}:Gt),t),c=Array.from(new Set([...i,...this.lookupTableAddress])),u=[];for(let g of c)a[g]===void 0&&u.push(new Je(g));let l=await Tn({connection:this.connection,address:u});for(let[g,h]of Object.entries(l))a[g]=h;let m=r?Je.default.toBase58():o!=null?o:await Ye(this.connection,this.blockhashCommitment),d=new gt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Pt(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var k;let{skipPreflight:h=!0,sendAndConfirm:w,notSendToRpc:A}=g||{};if(Ue([p]),(k=this.owner)!=null&&k.isKeyPair){let x=await this.connection.sendTransaction(p,{skipPreflight:h});return w&&await _t(this.connection,x),{txId:x,signedTx:p}}if(this.signAllTransactions){let x=await this.signAllTransactions([p]);if(this.signers.length)for(let I of x)try{I.sign(this.signers)}catch{}return{txId:A?"":await this.connection.sendTransaction(x[0],{skipPreflight:h}),signedTx:x[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:f=!0}=l||{};if(p&&s.forEach(g=>g.message.recentBlockhash=p),Ue(s),(b=this.owner)!=null&&b.isKeyPair){if(m){let g=[];for(let h of s){let w=await this.connection.sendTransaction(h,{skipPreflight:f});await _t(this.connection,w),g.push(w)}return{txIds:g,signedTxs:s}}return{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:f}))),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(m){let h=0,w=[],A=async()=>{if(!g[h])return;let k=await this.connection.sendTransaction(g[h],{skipPreflight:f});w.push({txId:k,status:"sent",signedTx:g[h]}),d==null||d([...w]),h++;let x=!1,I=null,S=null,T=W=>{I!==null&&clearInterval(I),S!==null&&this.connection.removeSignatureListener(S);let _=w.findIndex(E=>E.txId===k);if(_>-1){if(w[_].status==="error"||w[_].status==="success")return;w[_].status=W.err?"error":"success"}d==null||d([...w]),W.err||A()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var W;if(x){clearInterval(I);return}try{let _=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(x=!0,clearInterval(I),T({err:((W=_.meta)==null?void 0:W.err)||null}),console.log("tx status from getTransaction:",k))}catch(_){x=!0,clearInterval(I),console.error("getTransaction timeout:",_,k)}},Xt)),S=this.connection.onSignature(k,W=>{if(x){this.connection.removeSignatureListener(S);return}x=!0,T(W)},"confirmed"),this.connection.getSignatureStatus(k)};return A(),{txIds:[],signedTxs:g}}else{let h=[];for(let w=0;w<g.length;w+=1){let A=await this.connection.sendTransaction(g[w],{skipPreflight:f});h.push(A)}return{txIds:h,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:i}=m,r=Ve(m,["splitIns","computeBudgetConfig"]),o=i?Wt(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,f)=>Q(G({},p),{[f.publicKey.toBase58()]:f}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(p=>{let f=[...u,p],b=i?[...o.instructions,...f]:f,h=[...new Set(f.map(w=>w.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(w=>new Je(w));if(p!==t[l]&&u.length<12&&(pt({instructions:b,payer:this.feePayer,signers:h})||pt({instructions:f,payer:this.feePayer,signers:h})))u.push(p);else{if(u.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,pt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:h})?a.push(new yt().add(...o.instructions,...u)):a.push(new yt().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[p]}}),u.length>0){let f=[...new Set(u.map(b=>b.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(b=>s[b]).filter(b=>b!==void 0);pt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:f.map(b=>b.publicKey)})?a.push(new yt().add(...o.instructions,...u)):a.push(new yt().add(...u)),c.push(f)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(p=>{p.some(f=>f.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var k;let{sequentially:f,onTxUpdate:b,skipTxCount:g=0,recentBlockHash:h,skipPreflight:w=!0}=p||{},A=h!=null?h:await Ye(this.connection,this.blockhashCommitment);if(a.forEach(async(x,I)=>{x.recentBlockhash=A,c[I].length&&x.sign(...c[I])}),Ue(a),(k=this.owner)!=null&&k.isKeyPair){if(f){let x=0,I=[];for(let S of a){if(++x,x<=g){I.push("tx skipped");continue}let T=await Bn(this.connection,S,this.signers.find(W=>W.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});I.push(T)}return{txIds:I,signedTxs:a}}return{txIds:await Promise.all(a.map(async x=>await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let x=await this.signAllTransactions(a.slice(g,a.length)),I=[...a.slice(0,g),...x];if(f){let S=0,T=[],W=async()=>{if(!I[S])return;S<g&&(T.push({txId:"",status:"success",signedTx:I[S]}),b==null||b([...T]),S++,W());let _=await this.connection.sendRawTransaction(I[S].serialize(),{skipPreflight:w});T.push({txId:_,status:"sent",signedTx:I[S]}),b==null||b([...T]),S++;let E=!1,B=null,N=null,H=F=>{B!==null&&clearInterval(B),N!==null&&this.connection.removeSignatureListener(N);let R=T.findIndex(ce=>ce.txId===_);if(R>-1){if(T[R].status==="error"||T[R].status==="success")return;T[R].status=F.err?"error":"success"}b==null||b([...T]),F.err||W()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var F;if(E){clearInterval(B);return}try{let R=await this.connection.getTransaction(_,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(E=!0,clearInterval(B),H({err:((F=R.meta)==null?void 0:F.err)||null}),console.log("tx status from getTransaction:",_))}catch(R){E=!0,clearInterval(B),console.error("getTransaction timeout:",R,_)}},Xt)),N=this.connection.onSignature(_,F=>{if(E){this.connection.removeSignatureListener(N);return}E=!0,H(F)},"confirmed"),this.connection.getSignatureStatus(_)};return await W(),{txIds:T.map(_=>_.txId),signedTxs:I}}else{let S=[];for(let T=0;T<I.length;T+=1){let W=await this.connection.sendRawTransaction(I[T].serialize(),{skipPreflight:w});S.push(W)}return{txIds:S,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var A;let w=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=w,s=Ve(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=G(G({},this.cluster==="devnet"?{}:Gt),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let k of c)a[k]===void 0&&u.push(new Je(k));let l=await Tn({connection:this.connection,address:u});for(let[k,x]of Object.entries(l))a[k]=x;let m=t?Wt(t):{instructions:[],instructionTypes:[]},d=await Ye(this.connection,this.blockhashCommitment),p=this.signers.reduce((k,x)=>Q(G({},k),{[x.publicKey.toBase58()]:x}),{}),f=[],b=[],g=[],h=0;if(this.allInstructions.forEach(k=>{let x=[...g,k],I=t?[...m.instructions,...x]:x;if(k!==i[h]&&g.length<12&&(ft({instructions:I,payer:this.feePayer,lookupTableAddressAccount:a})||ft({instructions:x,payer:this.feePayer,lookupTableAddressAccount:a})))g.push(k);else{if(g.length===0)throw Error("item ins too big");h+=k===i[h]?1:0;let S={};for(let T of[...new Set(c)])a[T]!==void 0&&(S[T]=a[T]);if(t&&ft({instructions:[...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let T=new gt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...g]}).compileToV0Message(Object.values(a));f.push(new Pt(T))}else{let T=new gt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(a));f.push(new Pt(T))}b.push(Array.from(new Set(g.map(T=>T.keys.filter(W=>W.isSigner).map(W=>W.pubkey.toString())).flat())).map(T=>p[T]).filter(T=>T!==void 0)),g=[k]}}),g.length>0){let x=[...new Set(g.map(I=>I.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(I=>p[I]).filter(I=>I!==void 0);if(t&&ft({instructions:[...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let I=new gt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...g]}).compileToV0Message(Object.values(a));f.push(new Pt(I))}else{let I=new gt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(a));f.push(new Pt(I))}b.push(x)}return(A=this.owner)!=null&&A.signer&&b.forEach(k=>{k.some(x=>x.publicKey.equals(this.owner.publicKey))||k.push(this.owner.signer)}),f.forEach((k,x)=>{k.sign(b[x])}),{builder:this,transactions:f,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async k=>{var _;let{sequentially:x,onTxUpdate:I,skipTxCount:S=0,recentBlockHash:T,skipPreflight:W=!0}=k||{};if(f.map(async(E,B)=>{b[B].length&&E.sign(b[B]),T&&(E.message.recentBlockhash=T)}),Ue(f),(_=this.owner)!=null&&_.isKeyPair){if(x){let E=0,B=[];for(let N of f){if(++E,E<=S){console.log("skip tx: ",E),B.push("tx skipped");continue}let H=await this.connection.sendTransaction(N,{skipPreflight:W});await _t(this.connection,H),B.push(H)}return{txIds:B,signedTxs:f}}return{txIds:await Promise.all(f.map(async E=>await this.connection.sendTransaction(E,{skipPreflight:W}))),signedTxs:f}}if(this.signAllTransactions){let E=await this.signAllTransactions(f.slice(S,f.length)),B=[...f.slice(0,S),...E];if(x){let N=0,H=[],F=async()=>{if(!B[N])return;if(N<S){H.push({txId:"",status:"success",signedTx:B[N]}),I==null||I([...H]),N++,F();return}let R=await this.connection.sendTransaction(B[N],{skipPreflight:W});H.push({txId:R,status:"sent",signedTx:B[N]}),I==null||I([...H]),N++;let ce=!1,ae=null,ie=null,z=ee=>{ae!==null&&clearInterval(ae),ie!==null&&this.connection.removeSignatureListener(ie);let ue=H.findIndex(st=>st.txId===R);if(ue>-1){if(H[ue].status==="error"||H[ue].status==="success")return;H[ue].status=ee.err?"error":"success"}I==null||I([...H]),ee.err||F()};this.loopMultiTxStatus&&(ae=setInterval(async()=>{var ee;if(ce){clearInterval(ae);return}try{let ue=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});ue&&(ce=!0,clearInterval(ae),z({err:((ee=ue.meta)==null?void 0:ee.err)||null}),console.log("tx status from getTransaction:",R))}catch(ue){ce=!0,clearInterval(ae),console.error("getTransaction timeout:",ue,R)}},Xt)),ie=this.connection.onSignature(R,ee=>{if(ce){this.connection.removeSignatureListener(ie);return}ce=!0,z(ee)},"confirmed"),this.connection.getSignatureStatus(R)};return F(),{txIds:[],signedTxs:B}}else{let N=[];for(let H=0;H<B.length;H+=1){let F=await this.connection.sendTransaction(B[H],{skipPreflight:W});N.push(F)}return{txIds:N,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var xn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),$e=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=re(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ht({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(xn(e))}logInfo(...e){this.logger.info(xn(e))}logAndCreateError(...e){let t=xn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as ff}from"@solana/web3.js";import yf from"bn.js";import{AccountLayout as wf,createAssociatedTokenAccountIdempotentInstruction as kf,TOKEN_2022_PROGRAM_ID as hf,TOKEN_PROGRAM_ID as Tf}from"@solana/spl-token";import{PublicKey as Nl}from"@solana/web3.js";import{MintLayout as Rl,TOKEN_PROGRAM_ID as vl}from"@solana/spl-token";import{Keypair as Op,PublicKey as Dp,SystemProgram as _p,TransactionInstruction as Vp}from"@solana/web3.js";import Up from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Hp,TOKEN_2022_PROGRAM_ID as zp,TOKEN_PROGRAM_ID as Zp}from"@solana/spl-token";import{PublicKey as os}from"@solana/web3.js";import Ei,{isBN as Oi}from"bn.js";import{bits as Vl,BitStructure as ql,blob as jo,Blob as Ul,cstr as Gl,f32 as Xl,f32be as Hl,f64 as zl,f64be as Zl,greedy as jl,Layout as Qo,ns64 as Ql,ns64be as Yl,nu64 as Jl,nu64be as $l,offset as Yo,s16 as em,s16be as tm,s24 as nm,s24be as im,s32 as Jo,s32be as rm,s40 as om,s40be as sm,s48 as am,s48be as um,s8 as cm,seq as $o,struct as lm,Structure as es,u16 as ts,u16be as mm,u24 as dm,u24be as pm,u32 as ns,u32be as fm,u40 as bm,u40be as ym,u48 as gm,u48be as Pm,u8 as is,UInt as rs,union as Am,Union as wm,unionLayoutDiscriminator as km,utf8 as hm}from"@solana/buffer-layout";var In=Qo,Li=es;var Sn=rs;var Ri=is,He=ts;var Mi=ns;var Ke=Jo;var vi=$o;var me=jo;var Fi=Yo;var et=class extends In{constructor(t,i,r){super(t,r);this.blob=me(t),this.signed=i}decode(t,i=0){let r=new Ei(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new Ei(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function U(n){return new Sn(1,n)}function nt(n){return new Sn(4,n)}function P(n){return new et(8,!1,n)}function $(n){return new et(16,!1,n)}function Di(n){return new et(8,!0,n)}function Wi(n){return new et(16,!0,n)}var tt=class extends In{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function v(n){return new tt(me(32),e=>new os(e),e=>e.toBuffer(),n)}function Kn(n){return new tt(Ri(),ss,as,n)}function ss(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function as(n){return n?1:0}function us(n){let e=Mi("length"),t=q([e,me(Fi(e,-e.span),"data")]);return new tt(t,({data:i})=>i,i=>({data:i}),n)}function Pe(n){return new tt(us(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),n)}var Cn=class extends Li{decode(e,t){return super.decode(e,t)}};function q(n,e,t){return new Cn(n,e,t)}function Z(n,e,t){let i,r=typeof e=="number"?e:Oi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=Oi(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return vi(n,r,t)}import gp from"bn.js";import fe from"bn.js";var Nn=new fe(0),_i=new fe(1),Vi=new fe(-1),Ae=new fe(1).shln(64),qi=new fe(1).shln(128),Ln=Ae.sub(_i);var cs=qi.subn(1),it=-443636,At=-it,Rn=new fe("4295048016"),Mn=new fe("79226673521066979257578248091"),vm=new fe("4295048017"),Fm=new fe("79226673521066979257578248090");var ls=new fe(10).pow(new fe(6));var Em=new fe("18446744073700000000");import ip from"bn.js";var qm=Buffer.from("amm_config","utf8"),Um=Buffer.from("pool","utf8"),Gm=Buffer.from("pool_vault","utf8"),Xm=Buffer.from("pool_reward_vault","utf8"),Hm=Buffer.from("position","utf8"),zm=Buffer.from("tick_array","utf8"),Zm=Buffer.from("operation","utf8"),jm=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Qm=Buffer.from("observation","utf8");function vn(n){return ge([Buffer.from("metadata","utf8"),Qe.toBuffer(),n.toBuffer()],Qe)}var Ym=Buffer.from("locked_position","utf8");var Jm=Buffer.from("support_mint","utf8");import{PublicKey as Ld}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Md}from"@solana/spl-token";import Fd from"bn.js";import td from"bn.js";var On=14;var zt=60;var bs=q([me(8),U("bump"),He("index"),v(""),nt("protocolFeeRate"),nt("tradeFeeRate"),He("tickSpacing"),Z(P(),8,"")]),ys=q([nt("blockTimestamp"),Di("tickCumulative"),Z(P(),4)]),Ji=q([me(8),Kn("initialized"),P("recentEpoch"),He("observationIndex"),v("poolId"),Z(ys,100,"observations"),Z(P(),4)]),gs=q([U("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),$("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),v("tokenMint"),v("tokenVault"),v("creator"),$("rewardGrowthGlobalX64")]),ji=q([me(8),U("bump"),v("ammConfig"),v("creator"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("observationId"),U("mintDecimalsA"),U("mintDecimalsB"),He("tickSpacing"),$("liquidity"),$("sqrtPriceX64"),Ke("tickCurrent"),nt(),$("feeGrowthGlobalX64A"),$("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),$("swapInAmountTokenA"),$("swapOutAmountTokenB"),$("swapInAmountTokenB"),$("swapOutAmountTokenA"),U("status"),Z(U(),7,""),Z(gs,3,"rewardInfos"),Z(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),Z(P(),15*4-3,"padding")]),Ps=q([$("growthInsideLastX64"),P("rewardAmountOwed")]),Qi=q([me(8),U("bump"),v("nftMint"),v("poolId"),Ke("tickLower"),Ke("tickUpper"),$("liquidity"),$("feeGrowthInsideLastX64A"),$("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),Z(Ps,3,"rewardInfos"),Z(P(),8,"")]),Sp=q([me(8),U("bump"),v("poolId"),Ke("tickLowerIndex"),Ke("tickUpperIndex"),$("liquidity"),$("feeGrowthInsideLastX64A"),$("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),Z($(),3,"rewardGrowthInside"),Z(P(),8,"")]),As=q([Ke("tick"),Wi("liquidityNet"),$("liquidityGross"),$("feeGrowthOutsideX64A"),$("feeGrowthOutsideX64B"),Z($(),3,"rewardGrowthsOutsideX64"),Z(nt(),13,"")]),Hi=q([me(8),v("poolId"),Ke("startTickIndex"),Z(As,zt,"ticks"),U("initializedTickCount"),Z(U(),115,"")]),ws=q([me(329),Z(v(),100,"whitelistMints")]),fs=q([me(8),v("poolId"),Z(Z(P(),8),On,"positiveTickArrayBitmap"),Z(Z(P(),8),On,"negativeTickArrayBitmap")]),Cp=q([P(),U("bump"),v("owner"),v("poolId"),v("positionId"),v("nftAccount"),Z(P(),8)]),ks=q([me(8),U("bump"),v("lockOwner"),v("poolId"),v("positionId"),v("nftAccount"),v("lockNftMint"),P("recentEpoch"),Z(P(),8)]);Ji.span;var rf=re("Raydium_Clmm");var xs=Buffer.from("vault_auth_seed","utf8"),ub=Buffer.from("global_config","utf8"),Is=Buffer.from("pool","utf8"),Ss=Buffer.from("pool_vault","utf8"),Cs=Buffer.from("pool_vesting","utf8"),Ks=Buffer.from("platform_config","utf8");function Oe(n){return ge([xs],n)}function Zt(n,e,t){return ge([Is,e.toBuffer(),t.toBuffer()],n)}function Dn(n,e,t){return ge([Ss,e.toBuffer(),t.toBuffer()],n)}function jt(n){return ge([Buffer.from("__event_authority","utf8")],n)}function Wn(n,e){return ge([Ks,e.toBuffer()],n)}function ht(n,e,t){return ge([Cs,e.toBuffer(),t.toBuffer()],n)}import{SystemProgram as Tt,TransactionInstruction as De}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as $i}from"@solana/spl-token";import er from"bn.js";var We={initialize:Buffer.from([175,175,109,31,13,152,155,237]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143])};function tr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,h,w,A,k,x){let I=q([U("decimals"),Pe("name"),Pe("symbol"),Pe("uri")]),S=q([P("totalLockedAmount"),P("cliffPeriod"),P("unlockPeriod")]),T=q([U("index"),P("supply"),P("totalFundRaisingB"),U("migrateType")]),W=q([U("index"),P("supply"),P("totalSellA"),P("totalFundRaisingB"),U("migrateType")]),_=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1},{pubkey:jt(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}],E=Buffer.alloc(Buffer.from(b,"utf-8").length+Buffer.from(g,"utf-8").length+Buffer.from(h,"utf-8").length+4*3+1),B=Buffer.alloc(S.span),N=Buffer.alloc(w.type==="ConstantCurve"?W.span:T.span);return I.encode({decimals:f,name:b,symbol:g,uri:h},E),w.type==="ConstantCurve"?W.encode(Q(G({index:0},w),{migrateType:w.migrateType==="amm"?0:1}),N):w.type==="FixedCurve"?T.encode(Q(G({index:1},w),{migrateType:w.migrateType==="amm"?0:1}),N):w.type==="LinearCurve"&&T.encode(Q(G({index:2},w),{migrateType:w.migrateType==="amm"?0:1}),N),S.encode({totalLockedAmount:A,cliffPeriod:k,unlockPeriod:x},B),new De({keys:_,programId:n,data:Buffer.from([...We.initialize,...E,...N,...B])})}function nr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,h){let w=q([P("amountB"),P("minAmountA"),P("shareFeeRate")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:jt(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&A.push({pubkey:h,isSigner:!1,isWritable:!0}),console.log({amountB:f.toString(),minAmountA:b.toString()});let k=Buffer.alloc(w.span);return w.encode({amountB:f,minAmountA:b,shareFeeRate:g!=null?g:new er(0)},k),new De({keys:A,programId:n,data:Buffer.from([...We.buyExactIn,...k])})}function ir(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,h){let w=q([P("amountA"),P("minAmountB"),P("shareFeeRate")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:jt(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&A.push({pubkey:h,isSigner:!1,isWritable:!0});let k=Buffer.alloc(w.span);return w.encode({amountA:f,minAmountB:b,shareFeeRate:g!=null?g:new er(0)},k),new De({keys:A,programId:n,data:Buffer.from([...We.sellExactIn,...k])})}function _n(n,e,t,i,r,o,s,a,c){let u=q([]),l=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:$i,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new De({keys:l,programId:n,data:Buffer.from([...We.claimVestedToken,...m])})}function Vn(n,e,t,i,r,o){let s=q([P("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:Tt.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:o},c),new De({keys:a,programId:n,data:Buffer.from([...We.createVestingAccount,...c])})}function qn(n,e,t,i,r,o,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Tt.programId,isSigner:!1,isWritable:!0},{pubkey:$i,isSigner:!1,isWritable:!0}];return new De({keys:u,programId:n,data:We.claimPlatformFee})}function rr(n,e,t,i,r,o,s,a,c,u,l){let m=q([P("platformScale"),P("creatorScale"),P("burnScale"),P("feeRate"),Pe("name"),Pe("web"),Pe("img")]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Tt.programId,isSigner:!1,isWritable:!1}],p=Buffer.alloc(8*4+Buffer.from(c,"utf-8").length+Buffer.from(u,"utf-8").length+Buffer.from(l,"utf-8").length+4*3);return m.encode({platformScale:s.platformScale,creatorScale:s.creatorScale,burnScale:s.burnScale,feeRate:a,name:c,web:u,img:l},p),new De({keys:d,programId:n,data:Buffer.from([...We.createPlatformConfig,...p])})}function or(n,e,t,i){let r=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],o;if(i.type==="updateClaimFeeWallet"){let s=q([U("index"),v("value")]);o=Buffer.alloc(s.span),s.encode({index:0,value:i.value},o)}else if(i.type==="updateLockNftWallet"){let s=q([U("index"),v("value")]);o=Buffer.alloc(s.span),s.encode({index:1,value:i.value},o)}else if(i.type==="migrateCpLockNftScale"){let s=q([U("index"),P("platformScale"),P("creatorScale"),P("burnScale")]);o=Buffer.alloc(s.span),s.encode(G({index:2},i.value),o)}else if(i.type==="updateFeeRate"){let s=q([U("index"),P("value")]);o=Buffer.alloc(s.span),s.encode({index:3,value:i.value},o)}else if(i.type==="updateImg"||i.type==="updateName"||i.type==="updateWeb"){let s=q([U("index"),Pe("value")]);o=Buffer.alloc(Buffer.from(i.value,"utf-8").length+4+1*1),i.type==="updateName"?s.encode({index:4,value:i.value},o):i.type==="updateWeb"?s.encode({index:5,value:i.value},o):i.type==="updateImg"&&s.encode({index:6,value:i.value},o)}else if(i.type==="updateCpConfigId"){r.push({pubkey:i.value,isSigner:!1,isWritable:!1});let s=q([U("index")]);o=Buffer.alloc(s.span),s.encode({index:7},o)}else if(i.type==="updateAll"){console.log("Please note that this update will overwrite all data in the platform account with the new data."),r.push({pubkey:i.value.cpConfigId,isSigner:!1,isWritable:!1});let s=q([U("index"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),P("platformScale"),P("creatorScale"),P("burnScale"),P("feeRate"),Pe("name"),Pe("web"),Pe("img")]);o=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(i.value.name,"utf-8").length+Buffer.from(i.value.web,"utf-8").length+Buffer.from(i.value.img,"utf-8").length),s.encode({index:8,platformClaimFeeWallet:i.value.platformClaimFeeWallet,platformLockNftWallet:i.value.platformLockNftWallet,platformScale:i.value.migrateCpLockNftScale.platformScale,creatorScale:i.value.migrateCpLockNftScale.creatorScale,burnScale:i.value.migrateCpLockNftScale.burnScale,feeRate:i.value.feeRate,name:i.value.name,web:i.value.web,img:i.value.img},o)}else throw Error("updateInfo params type error");return new De({keys:r,programId:n,data:Buffer.from([...We.updatePlaformConfig,...o])})}import{NATIVE_MINT as en,TOKEN_PROGRAM_ID as se,createAssociatedTokenAccountIdempotentInstruction as ot}from"@solana/spl-token";import X from"bn.js";import{PublicKey as ur}from"@solana/web3.js";var rt=q([P(),P("epoch"),U("curveType"),He("index"),P("migrateFee"),P("tradeFeeRate"),P("maxShareFeeRate"),P("minSupplyA"),P("maxLockRate"),P("minSellRateA"),P("minMigrateRateA"),P("minFundRaisingB"),v("mintB"),v("protocolFeeOwner"),v("migrateFeeOwner"),v("migrateToAmmWallet"),v("migrateToCpmmWallet"),Z(P(),16)]),Ns=q([P("totalLockedAmount"),P("cliffPeriod"),P("unlockPeriod"),P("startTime"),P("totalAllocatedShare")]),Ne=q([P(),P("epoch"),U("bump"),U("status"),U("mintDecimalsA"),U("mintDecimalsB"),U("migrateType"),P("supply"),P("totalSellA"),P("virtualA"),P("virtualB"),P("realA"),P("realB"),P("totalFundRaisingB"),P("protocolFee"),P("platformFee"),P("migrateFee"),Ns.replicate("vestingSchedule"),v("configId"),v("platformId"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("creator"),Z(P(),8)]),wb=q([P(),P("epoch"),v("poolId"),v("beneficiary"),P("claimedAmount"),P("tokenShareAmount"),Z(P(),8)]),Qt=q([P(),P("epoch"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),P("platformScale"),P("creatorScale"),P("burnScale"),P("feeRate"),Z(U(),64,"name"),Z(U(),256,"web"),Z(U(),256,"img"),v("cpConfigId"),Z(U(),224)]);import Be from"bn.js";import Bt from"bn.js";var _e=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var Yt=class extends _e{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new V(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new V(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new V(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(r)).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){if(e.lte(i))throw Error("supply need gt total sell");let s=e.sub(i).sub(r);if(s.lte(new Bt(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(o);if(a.lte(new Bt(0)))throw Error("tfMinusMf <= 0");let c=a.mul(i).mul(i).div(s),u=a.mul(i).div(s).sub(t);if(u.lt(new Bt(0)))throw Error("supply/totalSell/totalLockedAmount diff too high");let l=c.div(u),m=t.mul(t).div(u);if(l.lt(new Bt(0))||m.lt(new Bt(0)))throw Error("invalid input 0");return{a:l,b:m,c:i}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:i}){let r=e.mul(i),o=t.add(e);return r.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:i}){let r=t.mul(e),o=i.sub(e);return qt(r,o)}};import sr from"bn.js";var Jt=class extends _e{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new V(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new V(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new V(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new sr(0)))throw Error("invalid input 1");let a=new sr(2).mul(t).sub(o),u=t.mul(s).div(a);return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:i}){return i.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:i}){let r=t.mul(e);return qt(r,i)}};import de from"bn.js";import ar from"bn.js";var xt=class{static _multipler(e){return new V(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:i}){return new V(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(i))}static getPriceX64({price:e,decimalA:t,decimalB:i}){let r=e.mul(this._multipler(i)).div(this._multipler(t));return new ar(r.mul(this._Q64).toFixed(0))}};xt._Q64=new V(new ar(1).shln(64).toString());var $t=class extends _e{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new V(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new V(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualA.mul(e.realA).toString()).div(xt._Q64).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new V(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new V(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new de(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new de(3)).sub(o),u=t.mul(new de(2)).mul(s).div(a),l=u.mul(u),m=t.mul(new de(2)).mul(Ae).div(l);if(!m.gt(new de(0)))throw Error("a need gt 0");if(!Ln.gt(m))throw Error("a need lt u64 max");return{a:m,b:new de(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let i=e.realB.add(t),r=new de(2).mul(i).mul(Ae).div(e.virtualA);return new de(new V(r.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let i=e.realA.add(t),r=i.mul(i),{div:o,mod:s}=e.virtualA.mul(r).divmod(new de(2).mul(Ae));return(s.isZero()?o:o.add(new de(1))).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let i=e.realA.sub(t),r=i.mul(i),{div:o,mod:s}=e.virtualA.mul(r).divmod(new de(2).mul(Ae)),a=s.isZero()?o:o.add(new de(1));return e.realB.sub(a)}static sellExactOut({poolInfo:e,amount:t}){let i=e.realB.sub(t),r=new de(2).mul(i).mul(Ae).div(e.virtualA),o=new de(new V(r.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var xe=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:i}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i.supply,totalFundRaising:i.totalFundRaisingB,totalSell:i.totalSellA,totalLockedAmount:i.vestingSchedule.totalLockedAmount,migrateFee:i.migrateFee,decimalA:i.mintDecimalsA,decimalB:i.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let l=this.getCurve(e),m=l.getInitParam({supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a}),d=l.getPoolInitPriceByInit(Q(G({},m),{decimalA:c,decimalB:u})),p=r.div(new Be(t-1)),f=new Be(0),b=[{price:d,totalSellSupply:0}],{a:g,b:h}=m,w=f,A=f;for(let k=1;k<t;k++){let x=k!==t-1?p:r.sub(A),I=this.buyExactIn({poolInfo:{virtualA:g,virtualB:h,realA:w,realB:A,totalFundRaisingB:r,totalSellA:o},amountB:x,protocolFeeRate:f,platformFeeRate:f,curveType:e,shareFeeRate:f});w=w.add(I.amountA),A=A.add(I.amountB);let S=this.getPrice({poolInfo:{virtualA:g,virtualB:h,realA:w,realB:A},decimalA:c,decimalB:u,curveType:e});b.push({price:S,totalSellSupply:new V(w.toString()).div(10**c).toNumber()})}return b}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i})}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r})}static getPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getEndPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:i,decimalB:r})}static checkParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,decimals:o,config:s,migrateType:a}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(Ge).lt(r))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new Be(10**o))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(Ge);if(i.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let l=e.sub(i).sub(r),m=e.mul(s.minMigrateRateA).div(Ge);if(l.lt(m))throw Error("migrate lt min migrate amount");let d=e.sub(i).sub(r),p=new Be(new V(d.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let f=new Be(10).pow(new Be(o));if(p.lte(f))throw Error("check migrate lp error")}else if(a==="cpmm"){let f=new Be(100);if(p.lte(f))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=i.add(s).add(r),c=this.calculateFee({amount:t,feeRate:a}),u=t.sub(c),l=this.getCurve(o),m=l.buyExactIn({poolInfo:e,amount:u}),d=e.totalSellA.sub(e.realA),p,f,b;if(m.gt(d)){p=d;let h=l.buyExactOut({poolInfo:e,amount:p});f=this.calculatePreFee({postFeeAmount:h,feeRate:a}),b=f.sub(h)}else p=m,f=t,b=c;let g=this.splitFee({totalFee:b,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:p,amountB:f,splitFee:g}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=e.totalSellA.sub(e.realA),c=t;t.gt(a)&&(c=a);let l=this.getCurve(o).buyExactOut({poolInfo:e,amount:t}),m=i.add(s).add(r),d=this.calculatePreFee({postFeeAmount:l,feeRate:m}),p=d.sub(l),f=this.splitFee({totalFee:p,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:c,amountB:d,splitFee:f}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let c=this.getCurve(o).sellExactIn({poolInfo:e,amount:t}),u=this.calculateFee({amount:c,feeRate:i.add(s).add(r)}),l=this.splitFee({totalFee:u,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:t,amountB:c.sub(u),splitFee:l}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=i.add(s).add(r),c=this.calculatePreFee({postFeeAmount:t,feeRate:a});if(e.realB.lt(c))throw Error("Insufficient liquidity");let u=c.sub(t),m=xe.getCurve(o).sellExactOut({poolInfo:e,amount:c});if(m.gt(e.realA))throw Error();let d=this.splitFee({totalFee:u,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:m,amountB:t,splitFee:d}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:i,shareFeeRate:r}){let o=t.add(i).add(r),s=o.isZero()?new Be(0):e.mul(i).div(o),a=o.isZero()?new Be(0):e.mul(r).div(o),c=e.sub(s).sub(a);return{platformFee:s,shareFee:a,protocolFee:c}}static calculateFee({amount:e,feeRate:t}){return ki(e,t,Ge)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let i=e.mul(Ge),r=Ge.sub(t);return i.add(r).sub(new Be(1)).div(r)}static getCurve(e){switch(e){case 0:return Yt;case 1:return Jt;case 2:return $t}throw Error("find curve error")}};var ze={initPriceX64:new X("515752397214619"),supply:new X(1e15),totalSellA:new X(7931e11),totalFundRaisingB:new X(85e9),totalLockedAmount:new X("0"),cliffPeriod:new X("0"),unlockPeriod:new X("0"),decimals:6,virtualA:new X("1073471847374405"),virtualB:new X("30050573465"),realA:new X(0),realB:new X(0),protocolFee:new X(0),platformId:new ur("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new X(0),cliffPeriod:new X(0),unlockPeriod:new X(0),startTime:new X(0),totalAllocatedShare:new X(0)}},tn=new X(1e4),Un=class extends $e{constructor(e){super(e)}async createLaunchpad(W){var _=W,{programId:e=pe,authProgramId:t,platformId:i=ze.platformId,mintA:r,decimals:o=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:l,configId:m,configInfo:d,platformFeeRate:p,txVersion:f,computeBudgetConfig:b,txTipConfig:g,feePayer:h,buyAmount:w,minMintAAmount:A,slippage:k,associatedOnly:x=!0,checkCreateATAOwner:I=!1,extraSigners:S}=_,T=Ve(_,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners"]);var Xn,Hn,zn,Zn,jn,Qn;let E=this.createTxBuilder(h);t=t!=null?t:Oe(e).publicKey;let B=d;if(!B&&m){let we=await this.scope.connection.getAccountInfo(m);we&&(B=rt.decode(we.data))}B||this.logAndCreateError("config not found");let N=B.mintB,H=B.curveType,{publicKey:F}=Zt(e,r,N),{publicKey:R}=Dn(e,F,r),{publicKey:ce}=Dn(e,F,N),{publicKey:ae}=vn(r);console.log(`create token: ${r.toBase58()}, mintB: ${N.toBase58()}, decimals A:${o}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty"),w.lte(new X(0))&&this.logAndCreateError("buy amount should gt 0:",w.toString());let ie=(Xn=T==null?void 0:T.supply)!=null?Xn:ze.supply,z=(Hn=T==null?void 0:T.totalSellA)!=null?Hn:ze.totalSellA,ee=(zn=T==null?void 0:T.totalFundRaisingB)!=null?zn:ze.totalFundRaisingB,ue=(Zn=T==null?void 0:T.totalLockedAmount)!=null?Zn:new X(0),st=p;if(!p){let we=await this.scope.connection.getAccountInfo(i);we||this.logAndCreateError("platform id not found:",i.toString()),st=Qt.decode(we.data).feeRate}let Gn=xe.getCurve(B.curveType).getInitParam({supply:ie,totalFundRaising:ee,totalSell:z,totalLockedAmount:ue,migrateFee:B.migrateFee}),Ie={epoch:new X(896),bump:254,status:0,mintDecimalsA:o,mintDecimalsB:s,supply:ie,totalSellA:z,mintA:new ur(r),mintB:N,virtualA:Gn.a,virtualB:Gn.b,realA:ze.realA,realB:ze.realB,migrateFee:B.migrateFee,migrateType:l==="amm"?0:1,protocolFee:ze.protocolFee,platformFee:st,platformId:i,configId:m,vaultA:R,vaultB:ce,creator:this.scope.ownerPubKey,totalFundRaisingB:ee,vestingSchedule:{totalLockedAmount:ue,cliffPeriod:new X(0),unlockPeriod:new X(0),startTime:new X(0),totalAllocatedShare:new X(0)}},cr=xe.getCurve(B.curveType),{c:lr}=cr.getInitParam({supply:Ie.supply,totalFundRaising:Ie.totalFundRaisingB,totalLockedAmount:ue,totalSell:B.curveType===0?Ie.totalSellA:new X(0),migrateFee:B.migrateFee});try{xe.checkParam({supply:Ie.supply,totalFundRaising:Ie.totalFundRaisingB,totalSell:lr,totalLockedAmount:ue,decimals:Ie.mintDecimalsA,config:B,migrateType:l}),console.log("check init params success")}catch(we){this.logAndCreateError(`check create mint params failed, ${we.message}`)}E.addInstruction({instructions:[tr(e,h!=null?h:this.scope.ownerPubKey,this.scope.ownerPubKey,m,i,t,F,r,N,R,ce,ae,se,se,o,a,c,u||"https://",{type:H===0?"ConstantCurve":H===1?"FixedCurve":H===2?"LinearCurve":"ConstantCurve",totalSellA:z,migrateType:l,supply:ie,totalFundRaisingB:ee},ue,(jn=T==null?void 0:T.cliffPeriod)!=null?jn:new X(0),(Qn=T==null?void 0:T.unlockPeriod)!=null?Qn:new X(0))]});let nn=new X(0),rn;if(S!=null&&S.length&&E.addInstruction({signers:S}),!T.createOnly){let{builder:we,extInfo:mr}=await this.buyToken({programId:e,authProgramId:t,mintA:r,mintB:N,poolInfo:Ie,buyAmount:w,minMintAAmount:A,shareFeeRate:T.shareFeeRate,shareFeeReceiver:T.shareFeeReceiver,configInfo:B,platformFeeRate:st,slippage:k,associatedOnly:x,checkCreateATAOwner:I});E.addInstruction(G({},we.AllTxData)),nn=mr.outAmount,rn=(this.scope.cluster==="devnet"||f===1)&&T.shareFeeReceiver?[we.allInstructions[0]]:void 0}return E.addTipInstruction(g),f===0?E.sizeCheckBuildV0({computeBudgetConfig:b,outAmount:nn,splitIns:rn,address:Q(G({},Ie),{poolId:F})}):E.sizeCheckBuild({computeBudgetConfig:b,outAmount:nn,splitIns:rn,address:Q(G({},Ie),{poolId:F})})}async buyToken({programId:e=pe,authProgramId:t,mintA:i,mintB:r=en,poolInfo:o,configInfo:s,platformFeeRate:a,txVersion:c,computeBudgetConfig:u,txTipConfig:l,feePayer:m,buyAmount:d,minMintAAmount:p,slippage:f,shareFeeRate:b=new X(0),shareFeeReceiver:g,associatedOnly:h=!0,checkCreateATAOwner:w=!1}){d.lte(new X(0))&&this.logAndCreateError("buy amount should gt 0:",d.toString());let A=this.createTxBuilder(m),{publicKey:k}=Zt(e,i,r);t=t!=null?t:Oe(e).publicKey;let x=null,I=null,S=r.equals(en),{account:T,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:h,checkCreateATAOwner:w});T&&(x=T),A.addInstruction(W||{}),x===void 0&&this.logAndCreateError(`cannot found mintA(${i.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let{account:_,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:S?{payer:this.scope.ownerPubKey,amount:d}:void 0,skipCloseAccount:!S,notUseTokenAccount:S,associatedOnly:S?!1:h,checkCreateATAOwner:w});_&&(I=_),A.addInstruction(E||{}),I===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let B=o;if(!B){let z=await this.scope.connection.getAccountInfo(k,{commitment:"processed"});z||this.logAndCreateError("cannot found pool:",k.toBase58()),B=Ne.decode(z.data)}let N=s,H=await Xe(this.scope.connection,[N?void 0:B.configId,a?void 0:B.platformId].filter(Boolean).map(z=>({pubkey:z})));if(!N){let z=H.find(ee=>ee.pubkey.equals(B.configId));(!z||!z.accountInfo)&&this.logAndCreateError("config not found: ",B.configId.toBase58()),N=rt.decode(z.accountInfo.data)}if(!a){let z=H.find(ee=>ee.pubkey.equals(B.platformId));(!z||!z.accountInfo)&&this.logAndCreateError("platform info not found: ",B.configId.toBase58()),a=Qt.decode(z.accountInfo.data).feeRate}let F=xe.buyExactIn({poolInfo:B,amountB:d,protocolFeeRate:N.tradeFeeRate,platformFeeRate:a,curveType:N.curveType,shareFeeRate:b}),R=new V(F.amountA.toString()),ce=f?new V(tn.sub(f).toNumber()/tn.toNumber()).clampedTo(0,1):new V(1),ae=p!=null?p:f?new X(R.mul(ce).toFixed(0)):F.amountA;F.amountB.lt(d)&&console.log(`maximum ${i.toBase58()} amount can buy is ${F.amountA.toString()}, input ${r.toBase58()} amount: ${F.amountB.toString()}`);let ie=g?Ce(g,r,se).publicKey:void 0;return ie&&A.addInstruction({instructions:[ot(this.scope.ownerPubKey,ie,g,r)]}),A.addInstruction({instructions:[nr(e,this.scope.ownerPubKey,t,B.configId,B.platformId,k,x,I,B.vaultA,B.vaultB,i,r,se,se,F.amountB.lt(d)?F.amountB:d,ae,b,ie)]}),A.addCustomComputeBudget(u),A.addTipInstruction(l),A.versionBuild({txVersion:c,extInfo:{outAmount:ae}})}async sellToken({programId:e=pe,authProgramId:t,mintA:i,mintB:r=en,poolInfo:o,configInfo:s,platformFeeRate:a,txVersion:c,computeBudgetConfig:u,txTipConfig:l,feePayer:m,sellAmount:d,minAmountB:p,slippage:f,shareFeeRate:b=new X(0),shareFeeReceiver:g,associatedOnly:h=!0,checkCreateATAOwner:w=!1}){t=t!=null?t:Oe(e).publicKey;let A=this.createTxBuilder(m);d.lte(new X(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:k}=Zt(e,i,r),x=null,I=null,S=r.equals(en),{account:T,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:h,checkCreateATAOwner:w});T&&(x=T),A.addInstruction(W||{}),x===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:_,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:S?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!S,notUseTokenAccount:S,associatedOnly:S?!1:h,checkCreateATAOwner:w});_&&(I=_),A.addInstruction(E||{}),I===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=o;if(!B){let z=await this.scope.connection.getAccountInfo(k,{commitment:"processed"});z||this.logAndCreateError("cannot found pool",k.toBase58()),B=Ne.decode(z.data)}let N=s,H=await Xe(this.scope.connection,[N?void 0:B.configId,a?void 0:B.platformId].filter(Boolean).map(z=>({pubkey:z})));if(!N){let z=H.find(ee=>ee.pubkey.equals(B.configId));(!z||!z.accountInfo)&&this.logAndCreateError("config not found: ",B.configId.toBase58()),N=rt.decode(z.accountInfo.data)}if(!a){let z=H.find(ee=>ee.pubkey.equals(B.platformId));(!z||!z.accountInfo)&&this.logAndCreateError("platform info not found: ",B.configId.toBase58()),a=Qt.decode(z.accountInfo.data).feeRate}let F=xe.sellExactIn({poolInfo:B,amountA:d,protocolFeeRate:N.tradeFeeRate,platformFeeRate:a,curveType:N.curveType,shareFeeRate:b}),R=new V(F.amountB.toString()),ce=f?new V(tn.sub(f).toNumber()/tn.toNumber()).clampedTo(0,1):new V(1),ae=p!=null?p:f?new X(R.mul(ce).toFixed(0)):F.amountB;ae.lte(new X(0))&&this.logAndCreateError(`out ${r.toBase58()} amount should be gt 0`);let ie=g?Ce(g,r,se).publicKey:void 0;return ie&&A.addInstruction({instructions:[ot(this.scope.ownerPubKey,ie,g,r)]}),A.addInstruction({instructions:[ir(e,this.scope.ownerPubKey,t,B.configId,B.platformId,k,x,I,B.vaultA,B.vaultB,i,r,se,se,F.amountA.lt(d)?F.amountA:d,ae,b,ie)]}),A.addCustomComputeBudget(u),A.addTipInstruction(l),A.versionBuild({txVersion:c,extInfo:{outAmount:ae}})}async createPlatformConfig({programId:e=pe,platformAdmin:t,platformClaimFeeWallet:i,platformLockNftWallet:r,cpConfigId:o,migrateCpLockNftScale:s,feeRate:a,name:c,web:u,img:l,txVersion:m,computeBudgetConfig:d,txTipConfig:p,feePayer:f}){let b=this.createTxBuilder(f),{publicKey:g}=Wn(e,t);return b.addInstruction({instructions:[rr(e,t,i,r,g,o,s,a,c,u,l)]}),b.addCustomComputeBudget(d),b.addTipInstruction(p),b.versionBuild({txVersion:m,extInfo:{platformId:g}})}async updatePlatformConfig({programId:e=pe,platformAdmin:t,platformId:i,updateInfo:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=i!=null?i:Wn(e,t).publicKey;return u.addInstruction({instructions:[or(e,t,l,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimPlatformFee({programId:e=pe,authProgramId:t,platformId:i,poolId:r,platformClaimFeeWallet:o,mintB:s,vaultB:a,mintBProgram:c=se,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d}){var h;let p=this.createTxBuilder(d);t=t!=null?t:Oe(e).publicKey;let f=s,b=a;if(!f){let w=await this.scope.connection.getAccountInfo(r,{commitment:"processed"});w||this.logAndCreateError("cannot found pool:",r.toBase58());let A=Ne.decode(w.data),k=await this.scope.connection.getAccountInfo(A.configId,{commitment:"processed"});k||this.logAndCreateError("cannot found config:",A.configId.toBase58()),f=rt.decode(k.data).mintB,b=b!=null?b:A.vaultB}(!f||!b)&&this.logAndCreateError("cannot found mint info, mintB: ",f.toBase58(),", vaultB: ",(h=b==null?void 0:b.toBase58())!=null?h:"");let g=Ce(this.scope.ownerPubKey,f,se).publicKey;return p.addInstruction({instructions:[ot(this.scope.ownerPubKey,g,this.scope.ownerPubKey,f)]}),p.addInstruction({instructions:[qn(e,o,t,r,i,b,g,f,c)]}),p.addCustomComputeBudget(l),p.addTipInstruction(m),p.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=pe,authProgramId:t,platformId:i,platformClaimFeeWallet:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:Oe(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Ne.span},{memcmp:{offset:Ne.offsetOf("platformId"),bytes:i.toString()}}]})).forEach(m=>{let d=Ne.decode(m.account.data);if(d.platformFee.lte(new X(0)))return;let p=Ce(this.scope.ownerPubKey,d.mintB,se).publicKey;u.addInstruction({instructions:[ot(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintB)]}),u.addInstruction({instructions:[qn(e,r,t,m.pubkey,i,d.vaultB,p,d.mintB,se)]})}),u.addTipInstruction(a),o===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=pe,poolId:t,beneficiary:i,shareAmount:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=await this.getRpcPoolInfo({poolId:t});r.add(l.vestingSchedule.totalAllocatedShare).gt(l.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=ht(e,t,i).publicKey;return u.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,i,t,m,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async createMultipleVesting({programId:e=pe,poolId:t,beneficiaryList:i,txVersion:r,computeBudgetConfig:o,feePayer:s}){let a=this.createTxBuilder(s);i.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return i.reduce((l,m)=>l.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),i.forEach(l=>{let m=ht(e,t,l.wallet).publicKey;a.addInstruction({instructions:[Vn(e,this.scope.ownerPubKey,l.wallet,t,m,l.shareAmount)]})}),r===0?a.sizeCheckBuildV0({computeBudgetConfig:o}):a.sizeCheckBuild({computeBudgetConfig:o})}async claimVesting({programId:e=pe,poolId:t,poolInfo:i,vestingRecord:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=Oe(e).publicKey,m=r||ht(e,t,this.scope.ownerPubKey).publicKey,d=i;if(!d){let f=await this.scope.connection.getAccountInfo(t);f||this.logAndCreateError("pool not found"),d=Ne.decode(f.data)}let p=Ce(this.scope.ownerPubKey,d.mintA,se).publicKey;return u.addInstruction({instructions:[ot(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintA)]}),u.addInstruction({instructions:[_n(e,this.scope.ownerPubKey,l,t,m,p,d.vaultA,d.mintA,se)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimMultiVesting({programId:e=pe,poolIdList:t,poolsInfo:i={},vestingRecords:r={},txVersion:o,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=G({},i),l=Oe(e).publicKey,m=t.filter(d=>!u[d.toBase58()]);if(m.length){let d=await this.getRpcPoolsInfo({poolIdList:m});u=G(G({},u),d.poolInfoMap)}return t.forEach(d=>{let p=d.toBase58(),f=u[p];f||this.logAndCreateError(`pool info not found: ${p}`);let b=r[p]||ht(e,d,this.scope.ownerPubKey).publicKey,g=Ce(this.scope.ownerPubKey,f.mintA,se).publicKey;c.addInstruction({instructions:[ot(this.scope.ownerPubKey,g,this.scope.ownerPubKey,f.mintA)]}),c.addInstruction({instructions:[_n(e,this.scope.ownerPubKey,l,d,b,g,f.vaultA,f.mintA,se)]})}),o===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let i=await Xe(this.scope.connection,e.map(c=>({pubkey:c})),t),r={},o=[];for(let c=0;c<e.length;c++){let u=i[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let l=Ne.decode(u.accountInfo.data);r[e[c].toBase58()]=Q(G({},l),{poolId:u.accountInfo.owner}),o.push(l.configId)}let s=await Xe(this.scope.connection,o.map(c=>({pubkey:c})),t),a={};for(let c=0;c<o.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+o[c].toBase58());let l=rt.decode(u.accountInfo.data);a[o[c].toBase58()]=Q(G({},l),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(r).reduce((c,u)=>Q(G({},c),{[u]:Q(G({},r[u]),{configInfo:a[r[u].configId.toBase58()]})}),{})}}};export{ze as LaunchpadPoolInitParam,Un as default};
//# sourceMappingURL=launchpad.mjs.map